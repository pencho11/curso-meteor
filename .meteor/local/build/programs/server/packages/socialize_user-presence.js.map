{"version":3,"sources":["meteor://ðŸ’»app/packages/socialize:user-presence/server/server.js","meteor://ðŸ’»app/packages/socialize:user-presence/server/publications.js","meteor://ðŸ’»app/packages/socialize:user-presence/server/user-presence.js","meteor://ðŸ’»app/packages/socialize:user-presence/common/collection.js","meteor://ðŸ’»app/packages/socialize:user-presence/common/common.js","meteor://ðŸ’»app/packages/socialize:user-presence/common/user-extensions.js"],"names":["module","export","UserPresence","Meteor","link","v","check","Match","determineStatus","UserSessions","methods","updateSessionStatus","status","Integer","userId","update","connection","id","$set","ServerPresence","userConnected","sessionConnected","userDisconnected","sessionDisconnected","publish","userPresenceSessionConnected","serverId","onStop","ready","is_auto","_ensureIndex","sessionId","cleanupFunctions","userOnlineFunctions","userOfflineFunctions","userIdleFunctions","sessionConnectedFunctions","sessionDisconnectedFunctions","onSessionConnected","sessionConnectedFunction","push","Error","forEach","sessionFunction","onSessionDisconnected","sessionDisconnectedFunction","onUserOnline","userOnlineFunction","userOnline","onlineFunction","onUserIdle","userIdleFunction","userIdle","idleFunction","onUserOffline","userOfflineFunction","userOffline","offlineFunction","sessions","find","fields","sessionCount","fetch","length","session","insert","_id","remove","onCleanup","cleanupFunction","cleanup","sessionIds","map","exportDefault","Mongo","Collection","User","construct","default","extendUser","setStatusIdle","call","setStatusOnline"],"mappings":"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","file":"/packages/socialize_user-presence.js","sourcesContent":["/* eslint-disable import/no-unresolved */\nimport { Meteor } from 'meteor/meteor';\nimport { check, Match } from 'meteor/check';\n\n/* eslint-enable import/no-unresolved */\n\nimport { determineStatus, UserPresence } from './user-presence.js';\nimport { UserSessions } from '../common/common.js';\n\nimport './publications.js';\n\nMeteor.methods({\n    updateSessionStatus(status) {\n        check(status, Match.Integer);\n        if (this.userId && (status === 1 || status === 2)) {\n            UserSessions.update(this.connection.id, { $set: { status } });\n            determineStatus(this.userId);\n        }\n    },\n});\n\n/* eslint-disable import/prefer-default-export */\nexport { UserPresence };\n","/* eslint-disable import/no-unresolved */\nimport { Meteor } from 'meteor/meteor';\nimport { ServerPresence } from 'meteor/socialize:server-presence';\n\n/* eslint-enable import/no-unresolved */\n\nimport { userConnected, sessionConnected, userDisconnected, sessionDisconnected } from './user-presence.js';\n\nMeteor.publish(null, function userPresenceSessionConnected() {\n    if (this.userId && this.connection && this.connection.id) {\n        userConnected(this.connection.id, this.userId, ServerPresence.serverId(), this.connection);\n        sessionConnected(this.connection, this.userId);\n\n        this.onStop(() => {\n            userDisconnected(this.connection.id, this.userId, this.connection);\n            sessionDisconnected(this.connection, this.userId);\n        });\n    }\n    this.ready();\n}, { is_auto: true });\n","/* eslint-disable import/no-unresolved */\nimport { Meteor } from 'meteor/meteor';\nimport { ServerPresence } from 'meteor/socialize:server-presence';\n\n/* eslint-enable import/no-unresolved */\n\nimport { UserSessions } from '../common/common.js';\n\nUserSessions._ensureIndex({ userId: 1 });\nUserSessions._ensureIndex({ serverId: 1 });\nUserSessions._ensureIndex({ sessionId: 1 });\n\nconst cleanupFunctions = [];\nconst userOnlineFunctions = [];\nconst userOfflineFunctions = [];\nconst userIdleFunctions = [];\nconst sessionConnectedFunctions = [];\nconst sessionDisconnectedFunctions = [];\n\n/* eslint-disable import/prefer-default-export */\nexport const UserPresence = {};\n\nUserPresence.onSessionConnected = (sessionConnectedFunction) => {\n    if (typeof sessionConnectedFunction === 'function') {\n        sessionConnectedFunctions.push(sessionConnectedFunction);\n    } else {\n        throw new Meteor.Error('Not A Function', 'UserPresence.onSessionConnected requires function as parameter');\n    }\n};\n\nexport const sessionConnected = (connection, userId) => {\n    sessionConnectedFunctions.forEach((sessionFunction) => {\n        sessionFunction(connection, userId);\n    });\n};\n\nUserPresence.onSessionDisconnected = (sessionDisconnectedFunction) => {\n    if (typeof sessionDisconnectedFunction === 'function') {\n        sessionDisconnectedFunctions.push(sessionDisconnectedFunction);\n    } else {\n        throw new Meteor.Error('Not A Function', 'UserPresence.onSessionDisconnected requires function as parameter');\n    }\n};\n\nexport const sessionDisconnected = (connection, userId) => {\n    sessionDisconnectedFunctions.forEach((sessionFunction) => {\n        sessionFunction(connection, userId);\n    });\n};\n\n\nUserPresence.onUserOnline = (userOnlineFunction) => {\n    if (typeof userOnlineFunction === 'function') {\n        userOnlineFunctions.push(userOnlineFunction);\n    } else {\n        throw new Meteor.Error('Not A Function', 'UserPresence.onUserOnline requires function as parameter');\n    }\n};\n\nconst userOnline = (userId, connection) => {\n    userOnlineFunctions.forEach((onlineFunction) => {\n        onlineFunction(userId, connection);\n    });\n};\n\nUserPresence.onUserIdle = (userIdleFunction) => {\n    if (typeof userIdleFunction === 'function') {\n        userIdleFunctions.push(userIdleFunction);\n    } else {\n        throw new Meteor.Error('Not A Function', 'UserPresence.onUserIdle requires function as parameter');\n    }\n};\n\nconst userIdle = (userId, connection) => {\n    userIdleFunctions.forEach((idleFunction) => {\n        idleFunction(userId, connection);\n    });\n};\n\nUserPresence.onUserOffline = (userOfflineFunction) => {\n    if (typeof userOfflineFunction === 'function') {\n        userOfflineFunctions.push(userOfflineFunction);\n    } else {\n        throw new Meteor.Error('Not A Function', 'UserPresence.onUserOffline requires function as parameter');\n    }\n};\n\nconst userOffline = (userId, connection) => {\n    userOfflineFunctions.forEach((offlineFunction) => {\n        offlineFunction(userId, connection);\n    });\n};\n\nexport const determineStatus = (userId, connection) => {\n    let status = 0;\n    const sessions = UserSessions.find({ userId }, { fields: { status: 1 } });\n    const sessionCount = sessions.fetch().length;\n\n    if (sessionCount > 0) {\n        status = 1;\n        sessions.forEach((session) => {\n            if (session.status === 2) {\n                status = 2;\n            }\n        });\n    }\n\n    switch (status) {\n        case 1:\n            userIdle(userId, connection);\n            break;\n        case 2:\n            userOnline(userId, connection);\n            break;\n        default:\n            userOffline(userId, connection);\n            break;\n    }\n};\n\nexport const userConnected = (sessionId, userId, serverId, connection) => {\n    UserSessions.insert({ serverId, userId, _id: sessionId, status: 2 });\n    determineStatus(userId, connection);\n};\n\nexport const userDisconnected = (sessionId, userId, connection) => {\n    UserSessions.remove(sessionId);\n    determineStatus(userId, connection);\n};\n\n\nUserPresence.onCleanup = (cleanupFunction) => {\n    if (typeof cleanupFunction === 'function') {\n        cleanupFunctions.push(cleanupFunction);\n    } else {\n        throw new Meteor.Error('Not A Function', 'UserPresence.onCleanup requires function as parameter');\n    }\n};\n\nconst cleanup = (sessionIds) => {\n    cleanupFunctions.forEach((cleanupFunction) => {\n        cleanupFunction(sessionIds);\n    });\n};\n\nServerPresence.onCleanup((serverId) => {\n    if (serverId) {\n        const sessionIds = UserSessions.find({ serverId }, { fields: { userId: true } }).map((session) => {\n            userDisconnected(session._id, session.userId, null);\n            return session._id;\n        });\n        cleanup(sessionIds);\n    } else {\n        cleanup();\n        UserSessions.remove({});\n    }\n});\n","\nexport default ({ Mongo }) => {\n    const UserSessions = new Mongo.Collection('presence:user-sessions');\n\n    return UserSessions;\n};\n","/* eslint-disable import/no-unresolved */\nimport { Meteor } from 'meteor/meteor';\nimport { User } from 'meteor/socialize:user-model';\nimport { Mongo } from 'meteor/mongo';\n/* eslint-enable import/no-unresolved */\n\nimport construct from './collection.js';\nimport extendUser from './user-extensions.js';\n\nextendUser({ Meteor, User });\nexport const UserSessions = construct({ Mongo });\n","export default ({ Meteor, User }) => {\n    User.methods({\n        setStatusIdle() {\n            Meteor.call('updateSessionStatus', 1);\n        },\n        setStatusOnline() {\n            Meteor.call('updateSessionStatus', 2);\n        },\n    });\n};\n"]}