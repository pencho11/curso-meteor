[{"type":"js","data":"/* Imports for global scope */\n\nMongoInternals = Package.mongo.MongoInternals;\nMongo = Package.mongo.Mongo;\nTracker = Package.tracker.Tracker;\nDeps = Package.tracker.Deps;\nECMAScript = Package.ecmascript.ECMAScript;\nValidatedMethod = Package['mdg:validated-method'].ValidatedMethod;\ncheck = Package.check.check;\nMatch = Package.check.Match;\nAccounts = Package['accounts-base'].Accounts;\nPublishEndpoint = Package['peerlibrary:middleware'].PublishEndpoint;\nPublishMiddleware = Package['peerlibrary:middleware'].PublishMiddleware;\nRoles = Package['alanning:roles'].Roles;\nMeteor = Package.meteor.Meteor;\nglobal = Package.meteor.global;\nmeteorEnv = Package.meteor.meteorEnv;\nWebApp = Package.webapp.WebApp;\nWebAppInternals = Package.webapp.WebAppInternals;\nmain = Package.webapp.main;\nDDP = Package['ddp-client'].DDP;\nDDPServer = Package['ddp-server'].DDPServer;\nLaunchScreen = Package['launch-screen'].LaunchScreen;\nmeteorInstall = Package.modules.meteorInstall;\nPromise = Package.promise.Promise;\nAutoupdate = Package.autoupdate.Autoupdate;\n\n","servePath":"/global-imports.js"},{"type":"js","data":"var require = meteorInstall({\"imports\":{\"startup\":{\"server\":{\"utilities\":{\"ResponseMessage.js\":function module(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                              //\n// imports/startup/server/utilities/ResponseMessage.js                                          //\n//                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                //\nmodule.export({\n  ResponseMessage: () => ResponseMessage\n});\n\nclass ResponseMessage {\n  constructor() {\n    this.message = null;\n    this.description = null;\n    this.data = null;\n  }\n\n  create(message) {\n    let description = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    let data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    this.message = message;\n    this.description = description;\n    this.data = data;\n  }\n\n}\n//////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"index.js\":function module(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                              //\n// imports/startup/server/index.js                                                              //\n//                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                //\nmodule.link(\"../../api/Users/UsersCtrl\");\nmodule.link(\"../../api/Users/UsersPubs\");\n//////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},\"api\":{\"Users\":{\"UsersCtrl.js\":function module(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                              //\n// imports/api/Users/UsersCtrl.js                                                               //\n//                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                //\nlet ValidatedMethod;\nmodule.link(\"meteor/mdg:validated-method\", {\n  ValidatedMethod(v) {\n    ValidatedMethod = v;\n  }\n\n}, 0);\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 1);\nlet ResponseMessage;\nmodule.link(\"../../startup/server/utilities/ResponseMessage\", {\n  ResponseMessage(v) {\n    ResponseMessage = v;\n  }\n\n}, 2);\nlet UsersServ;\nmodule.link(\"./UsersServ\", {\n  default(v) {\n    UsersServ = v;\n  }\n\n}, 3);\nnew ValidatedMethod({\n  name: 'user.save',\n\n  validate(user) {\n    try {\n      check(user, {\n        _id: Match.OneOf(String, null),\n        username: String,\n        emails: [{\n          address: String,\n          verified: Boolean\n        }],\n        profile: {\n          profile: String,\n          name: String,\n          path: Match.OneOf(String, null)\n        }\n      });\n    } catch (error) {\n      console.log('save.user', error);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    }\n\n    UsersServ.validateEmail(user.emails[0].address, user._id);\n    UsersServ.validateUsername(user.username, user._id);\n  },\n\n  run(user) {\n    const responseMessage = new ResponseMessage();\n\n    if (user._id !== null) {\n      try {\n        // UPDATE USER \n        UsersServ.updateUser(user);\n        responseMessage.create('Se actualizo el usuario exitosamente');\n      } catch (error) {\n        console.error('user.save', error);\n        throw new Meteor.Error('500', 'Ocurrio un error al actualizar el usuario');\n      }\n    } else {\n      try {\n        // CREATE USER\n        UsersServ.createUser(user);\n        responseMessage.create('Se ha creado usuario exitosamente');\n      } catch (error) {\n        console.error('user.save: ', error);\n        throw new Meteor.Error('500', 'Ocurri√≥ un error al crear un usuario');\n      }\n    }\n\n    return responseMessage;\n  }\n\n});\nnew ValidatedMethod({\n  name: 'user.delete',\n\n  validate(_ref) {\n    let {\n      idUser\n    } = _ref;\n\n    try {\n      check(idUser, String);\n    } catch (error) {\n      console.error('user.delete', error);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    }\n  },\n\n  run(_ref2) {\n    let {\n      idUser\n    } = _ref2;\n    const responseMessage = new ResponseMessage();\n\n    try {\n      Meteor.users.remove(idUser);\n      responseMessage.create('Se ha eliminado exitosamente al usuario');\n    } catch (error) {\n      console.error('user.delete', error);\n      throw new Meteor.Error('500', 'Ocurrio un error al eliminar un usuario');\n    }\n\n    return responseMessage;\n  }\n\n});\n//////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"UsersPubs.js\":function module(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                              //\n// imports/api/Users/UsersPubs.js                                                               //\n//                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                //\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet PublishEndpoint;\nmodule.link(\"meteor/peerlibrary:middleware\", {\n  PublishEndpoint(v) {\n    PublishEndpoint = v;\n  }\n\n}, 1);\nnew PublishEndpoint('user.list', function () {\n  return Meteor.users.find({}, {\n    sort: {\n      createdAt: -1\n    },\n    limit: 1\n  });\n});\n//////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"UsersServ.js\":function module(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                              //\n// imports/api/Users/UsersServ.js                                                               //\n//                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                //\nmodule.exportDefault({\n  validateEmail(newEmail, idUser) {\n    const existEmail = Accounts.findUserByEmail(newEmail);\n\n    if (idUser) {\n      const oldUser = Meteor.users.findOne(idUser);\n\n      if (oldUser.emails[0].address !== newEmail && existEmail) {\n        throw new Meteor.Error('403', 'El nuevo email ya se encuentra en uso');\n      }\n    } else if (existEmail) {\n      throw new Meteor.Error('403', 'El nuevo email ya se encuetra en uso');\n    }\n  },\n\n  validateUsername(newUsername, idUser) {\n    const existUsername = Accounts.findUserByUsername(newUsername);\n\n    if (idUser) {\n      const oldUser = Meteor.users.findOne(idUser);\n\n      if (oldUser.username !== newUsername && existUsername) {\n        throw new Meteor.Error('403', \"El nuevo nombre de usuario ya se encuentra en uso\");\n      }\n    } else if (existUsername) {\n      throw new Meteor.Error('403', \"El nombre de usuario ya se encuentra en uso\");\n    }\n  },\n\n  createUser(user) {\n    Accounts.createUser({\n      username: user.username,\n      email: user.emails[0].address,\n      profile: user.profile\n    });\n  },\n\n  updateUser(user) {\n    const currentUser = Meteor.users.findOne(user._id);\n\n    if (currentUser.emails[0].address !== user.emails[0].address) {\n      Accounts.removeEmail(currentUser._id, currentUser.emails[0].address);\n      Accounts.addEmail(currentUser._id, user.emails[0].address);\n    }\n\n    if (currentUser.username !== user.username) {\n      Accounts.setUsername(currentUser._id, user.username);\n    }\n\n    Meteor.users.update(user._id, {\n      $set: {\n        profile: {\n          profile: user.profile.profile,\n          name: user.profile.name,\n          path: user.profile.path\n        }\n      }\n    });\n  }\n\n});\n//////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}},\"server\":{\"main.js\":function module(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                              //\n// server/main.js                                                                               //\n//                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                //\nmodule.link(\"/imports/startup/server\");\n//////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\",\n    \".mjs\",\n    \".ts\",\n    \".vue\"\n  ]\n});\n\nvar exports = require(\"/server/main.js\");","hash":"0bcae1b9967870e6fb48a02b76084e8b0e1c5c3b","servePath":"/app.js","sourceMap":{"version":3,"sources":["imports/startup/server/utilities/ResponseMessage.js","imports/startup/server/index.js","imports/api/Users/UsersCtrl.js","imports/api/Users/UsersPubs.js","imports/api/Users/UsersServ.js","server/main.js"],"names":["module","export","ResponseMessage","constructor","message","description","data","create","link","ValidatedMethod","v","check","Match","UsersServ","default","name","validate","user","_id","OneOf","String","username","emails","address","verified","Boolean","profile","path","error","console","log","Meteor","Error","validateEmail","validateUsername","run","responseMessage","updateUser","createUser","idUser","users","remove","PublishEndpoint","find","sort","createdAt","limit","exportDefault","newEmail","existEmail","Accounts","findUserByEmail","oldUser","findOne","newUsername","existUsername","findUserByUsername","email","currentUser","removeEmail","addEmail","setUsername","update","$set"],"mappings":"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","file":"/app.js","sourcesContent":["export class ResponseMessage {\r\n    constructor(){\r\n        this.message = null;\r\n        this.description = null;\r\n        this.data = null;\r\n    }\r\n    \r\n    create(message, description = null, data = null){\r\n        this.message = message;\r\n        this.description = description;\r\n        this.data = data;\r\n    }\r\n}","import '../../api/Users/UsersCtrl';\r\nimport '../../api/Users/UsersPubs';","import {ValidatedMethod} from 'meteor/mdg:validated-method';\r\nimport {check, Match} from 'meteor/check';\r\nimport { ResponseMessage } from '../../startup/server/utilities/ResponseMessage';\r\nimport UsersServ from './UsersServ';\r\n\r\nnew ValidatedMethod ({\r\n    name: 'user.save',\r\n    validate(user){\r\n        try {\r\n            check(user, {\r\n                _id: Match.OneOf(String, null),\r\n                username: String,\r\n                emails: [{address: String, verified: Boolean}],\r\n                profile: {\r\n                    profile: String,\r\n                    name: String,\r\n                    path: Match.OneOf(String, null)\r\n                }\r\n            })\r\n        } catch (error) {\r\n            console.log('save.user', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\r\n        }\r\n        UsersServ.validateEmail(user.emails[0].address, user._id);\r\n        UsersServ.validateUsername(user.username, user._id);\r\n    },\r\n    run(user){\r\n        const responseMessage = new ResponseMessage();\r\n        if (user._id !== null) {\r\n            try {\r\n                // UPDATE USER \r\n                UsersServ.updateUser(user);\r\n                responseMessage.create('Se actualizo el usuario exitosamente');\r\n            } catch (error) {\r\n                console.error('user.save', error);\r\n                throw new Meteor.Error('500', 'Ocurrio un error al actualizar el usuario');\r\n            }\r\n        } else {\r\n            try {\r\n                // CREATE USER\r\n                UsersServ.createUser(user);\r\n                responseMessage.create('Se ha creado usuario exitosamente');\r\n            } catch (error) {\r\n                console.error('user.save: ', error);\r\n                throw new Meteor.Error('500', 'Ocurri√≥ un error al crear un usuario');\r\n            }\r\n        }\r\n        return responseMessage;\r\n    }\r\n});\r\n\r\nnew ValidatedMethod({\r\n    name: 'user.delete',\r\n    validate({idUser}){\r\n        try {\r\n            check(idUser, String);\r\n        } catch (error) {\r\n            console.error('user.delete', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\r\n        }\r\n    },\r\n    run({idUser}){\r\n        const responseMessage = new ResponseMessage;\r\n        try {\r\n            Meteor.users.remove(idUser);\r\n            responseMessage.create('Se ha eliminado exitosamente al usuario');\r\n        } catch (error) {\r\n            console.error('user.delete', error);\r\n            throw new Meteor.Error('500', 'Ocurrio un error al eliminar un usuario');\r\n        }\r\n        return responseMessage;\r\n    }\r\n});","import {Meteor} from 'meteor/meteor';\r\nimport {PublishEndpoint} from 'meteor/peerlibrary:middleware';\r\n\r\nnew PublishEndpoint('user.list', function() {\r\n    return Meteor.users.find({}, {\r\n        sort: {createdAt: -1},\r\n        limit: 1\r\n    });\r\n});","export default {\r\n    validateEmail(newEmail, idUser){\r\n        const existEmail = Accounts.findUserByEmail(newEmail);\r\n        if (idUser) {\r\n            const oldUser = Meteor.users.findOne(idUser);\r\n            if (oldUser.emails[0].address !== newEmail && existEmail) {\r\n                throw new Meteor.Error('403', 'El nuevo email ya se encuentra en uso');\r\n            }\r\n        } else if (existEmail) {\r\n            throw new Meteor.Error('403', 'El nuevo email ya se encuetra en uso');\r\n        }\r\n    },\r\n    validateUsername(newUsername, idUser){\r\n        const existUsername = Accounts.findUserByUsername(newUsername);\r\n        if (idUser) {\r\n            const oldUser = Meteor.users.findOne(idUser);\r\n            if (oldUser.username !== newUsername && existUsername) {\r\n                throw new Meteor.Error('403', \"El nuevo nombre de usuario ya se encuentra en uso\");\r\n            }\r\n        } else if (existUsername) {\r\n            throw new Meteor.Error('403', \"El nombre de usuario ya se encuentra en uso\");\r\n        }\r\n    },\r\n    createUser(user){\r\n        Accounts.createUser({\r\n            username: user.username,\r\n            email: user.emails[0].address,\r\n            profile: user.profile\r\n        });\r\n    },\r\n    updateUser(user){\r\n        const currentUser = Meteor.users.findOne(user._id);\r\n        if (currentUser.emails[0].address !== user.emails[0].address) {\r\n            Accounts.removeEmail(currentUser._id, currentUser.emails[0].address);\r\n            Accounts.addEmail(currentUser._id, user.emails[0].address);\r\n        }\r\n        if (currentUser.username !== user.username) {\r\n            Accounts.setUsername(currentUser._id, user.username);\r\n        }\r\n        Meteor.users.update(user._id, {\r\n            $set: {\r\n                profile: {\r\n                    profile: user.profile.profile,\r\n                    name: user.profile.name,\r\n                    path: user.profile.path\r\n                }\r\n            }\r\n        });\r\n    }\r\n}","import \"/imports/startup/server\";"]}}]