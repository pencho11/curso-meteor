[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar Blaze = Package.blaze.Blaze;\nvar UI = Package.blaze.UI;\nvar Handlebars = Package.blaze.Handlebars;\nvar Spacebars = Package.spacebars.Spacebars;\nvar SpacebarsCompiler = Package['spacebars-compiler'].SpacebarsCompiler;\nvar MongoInternals = Package.mongo.MongoInternals;\nvar Mongo = Package.mongo.Mongo;\nvar Random = Package.random.Random;\nvar HTML = Package.htmljs.HTML;\n\n/* Package-scope variables */\nvar Template, SSR;\n\n(function(){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/meteorhacks_ssr/lib/overrides.js                                                                    //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\n// we don't need autorun to go through Tracker\nBlaze.View.prototype.autorun = function(f) {\n  var handler = {stop: function() {}};\n  f.call(this, handler);\n  return handler;\n};\n\nSpacebars.With = function (argFunc, contentFunc, elseFunc) {\n  var argVar = new Blaze.ReactiveVar;\n  var view = Blaze.View('Spacebars_with', function () {\n    return Blaze.If(function () { return argVar.get(); },\n                    function () { return Blaze.With(function () {\n                      return argVar.get(); }, contentFunc); },\n                    elseFunc);\n  });\n\n  view.onViewCreated(function () {\n    this.autorun(function () {\n      argVar.set(argFunc());\n    });\n  });\n\n  return view;\n};\n\n// if we get a cursor from a templateHelper\n// we need fetch the data\n// observering us useless and throw errors\nvar originalLookup = Blaze.View.prototype.lookup;\nBlaze.View.prototype.lookup = function(key) {\n  var helper = originalLookup.apply(this, arguments);\n  return wrapHelper(helper);\n};\n\nfunction wrapHelper(helper) {\n  if(typeof helper != 'function') {\n    return helper;\n  }\n\n  return function() {\n    var res = helper.apply(this, arguments);\n    if(res && typeof res.observeChanges == 'function') {\n      return res.fetch();\n    } else {\n      return res;\n    }\n  }\n}\n\nvar originalTemplateWith = Blaze._TemplateWith;\nBlaze._TemplateWith = function(arg, contentFunc) {\n  // data is available instantly and if we delayed\n  // things won't work as expected\n\n  if(typeof arg == 'function') {\n    arg = arg();\n  }\n  return originalTemplateWith.call(this, arg, contentFunc);\n};\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/meteorhacks_ssr/lib/template.js                                                                     //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\n// Packages and apps add templates on to this object.\nTemplate = Blaze.Template;\n\n// Check for duplicate template names and illegal names that won't work.\nTemplate.__checkName = function (name) {\n  if (name in Template) {\n    if ((Template[name] instanceof Template) && name !== \"body\")\n      throw new Error(\"There are multiple templates named '\" + name + \"'. Each template needs a unique name.\");\n    throw new Error(\"This template name is reserved: \" + name);\n  }\n};\n\n// Define a template `Template.body` that renders its\n// `contentViews`.  `<body>` tags (of which there may be\n// multiple) will have their contents added to it.\nTemplate.body = new Template('body', function () {\n  var parts = Template.body.contentViews;\n  // enable lookup by setting `view.template`\n  for (var i = 0; i < parts.length; i++)\n    parts[i].template = Template.body;\n  return parts;\n});\nTemplate.body.contentViews = []; // array of Blaze.Views\nTemplate.body.view = null;\n\nTemplate.body.addContent = function (renderFunc) {\n  var kind = 'body_content_' + Template.body.contentViews.length;\n\n  Template.body.contentViews.push(Blaze.View(kind, renderFunc));\n};\n\n// This function does not use `this` and so it may be called\n// as `Meteor.startup(Template.body.renderIntoDocument)`.\nTemplate.body.renderToDocument = function () {\n\n};\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/meteorhacks_ssr/lib/dynamic.js                                                                      //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nTemplate.__dynamic = new Template(\"Template.__dynamic\", function() {\n  var view = this;\n  var template = Spacebars.call(view.lookup(\"template\"));\n  if(!template) {\n    throw new Error('you must specify template argument in UI.dynamic');\n  } else if(!Template[template]) {\n    throw new Error('there is no template defined to include with UI.dynamic: '  + template);\n  }\n\n  var data = Spacebars.call(view.lookup(\"data\"));\n  if(!data) {\n    // get data from the parent\n    data = Spacebars.call(view.lookup)\n  }\n\n  return Blaze._TemplateWith(data, function() {\n    return Spacebars.include(Template[template]);\n  });\n});\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/meteorhacks_ssr/lib/api.js                                                                          //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nvar format = Npm.require('util').format;\nvar Compilers = {};\nCompilers.html = SpacebarsCompiler;\nif(Package['mquandalle:jade-compiler']) {\n  Compilers.jade = Package['mquandalle:jade-compiler'].JadeCompiler;\n}\n\nSSR = {};\n\nSSR.render = function(templateName, data) {\n  var renderFunc = (data)? Blaze.toHTMLWithData : Blaze.toHTML;\n  var template = (typeof templateName == 'string')?\n    Template[templateName] : templateName;\n\n  return renderFunc(template, data);\n};\n\nSSR.compileTemplate = function(name, content, options) {\n  var language = options && options.language || \"html\";\n  var compiler = Compilers[language];\n  if(!compiler) {\n    throw Error(\"Unknown language: \" + language);\n  }\n\n  var compiled = compiler.compile(content);\n  var templateFmt = \"new Template('%s', function() {var view=this; return %s()})\";\n  var template = format(templateFmt, name, compiled);\n\n  return Template[name] = eval(template);\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nPackage._define(\"meteorhacks:ssr\", {\n  Template: Template,\n  SSR: SSR\n});\n\n})();\n","servePath":"/packages/meteorhacks_ssr.js"}]