[{"type":"js","data":"/* Imports for global scope */\n\nMongoInternals = Package.mongo.MongoInternals;\nMongo = Package.mongo.Mongo;\nTracker = Package.tracker.Tracker;\nDeps = Package.tracker.Deps;\nECMAScript = Package.ecmascript.ECMAScript;\nValidatedMethod = Package['mdg:validated-method'].ValidatedMethod;\ncheck = Package.check.check;\nMatch = Package.check.Match;\nAccounts = Package['accounts-base'].Accounts;\nPublishEndpoint = Package['peerlibrary:middleware'].PublishEndpoint;\nPublishMiddleware = Package['peerlibrary:middleware'].PublishMiddleware;\nRoles = Package['alanning:roles'].Roles;\nMethodHooks = Package['lacosta:method-hooks'].MethodHooks;\nTemplate = Package['meteorhacks:ssr'].Template;\nSSR = Package['meteorhacks:ssr'].SSR;\nMeteor = Package.meteor.Meteor;\nglobal = Package.meteor.global;\nmeteorEnv = Package.meteor.meteorEnv;\nWebApp = Package.webapp.WebApp;\nWebAppInternals = Package.webapp.WebAppInternals;\nmain = Package.webapp.main;\nDDP = Package['ddp-client'].DDP;\nDDPServer = Package['ddp-server'].DDPServer;\nLaunchScreen = Package['launch-screen'].LaunchScreen;\nmeteorInstall = Package.modules.meteorInstall;\nPromise = Package.promise.Promise;\nAutoupdate = Package.autoupdate.Autoupdate;\n\n","servePath":"/global-imports.js"},{"type":"js","data":"var require = meteorInstall({\"imports\":{\"startup\":{\"server\":{\"services\":{\"FirebaseAdmin.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/startup/server/services/FirebaseAdmin.js                                                            //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.export({\n  firebaseAdminStorage: () => firebaseAdminStorage,\n  BASE_URL_STORAGE: () => BASE_URL_STORAGE\n});\nlet firebaseAdmin;\nmodule.link(\"firebase-admin\", {\n  default(v) {\n    firebaseAdmin = v;\n  }\n\n}, 0);\nlet serviceAccount;\nmodule.link(\"../../../../settings/meteor-vue-fb643-firebase-adminsdk-50cu3-4c287411da.json\", {\n  default(v) {\n    serviceAccount = v;\n  }\n\n}, 1);\nfirebaseAdmin.initializeApp({\n  credential: firebaseAdmin.credential.cert(serviceAccount),\n  storageBucket: 'meteor-vue-fb643.appspot.com'\n});\nconst firebaseAdminStorage = firebaseAdmin.storage().bucket();\nconst BASE_URL_STORAGE = 'https://storage.googleapis.com';\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"MailServ.js\":function module(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/startup/server/services/MailServ.js                                                                 //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nif (Meteor.isDevelopment) {\n  var _Meteor$settings$priv;\n\n  if ((_Meteor$settings$priv = Meteor.settings.private) !== null && _Meteor$settings$priv !== void 0 && _Meteor$settings$priv.SENDER_EMAILS) {\n    process.env.EMAIL_SERVICES = Meteor.settings.private.SENDER_EMAILS.SERVICES;\n  } else {\n    console.warn('[Meteor + Vue] - Sender emails are not configured, Emails will not be send');\n  }\n}\n\nconst name = 'Scaffold Metor + Vue';\nconst email = \"<\".concat(process.env.EMAIL_SERVICES, \">\");\nconst from = \"\".concat(name, \" \").concat(email);\nAccounts.emailTemplates.siteName = name;\nAccounts.emailTemplates.from = from;\nconst emailTemplates = Accounts.emailTemplates;\nconst emailEnrollAccount = 'email_enroll_account.html';\nconst emailResetPassword = 'email_reset_password.html';\nconst emailVerifyEmail = 'email_verify_email.html';\nconst productSrc = 'http://localhost:3000/img/vue-meteor.png';\nconst logoSrc = 'http://localhost:3000/img/PoweredDark.png';\nemailTemplates.enrollAccount = {\n  subject() {\n    return \"Bienvenido a \".concat(name);\n  },\n\n  html(user, url) {\n    const urlWithoutHash = url.replace('#/', '');\n    if (Meteor.isDevelopment) console.info('Set initial password link: ', urlWithoutHash);\n    SSR.compileTemplate('emailEnrollAccount', Assets.getText(emailEnrollAccount));\n    return SSR.render('emailEnrollAccount', {\n      urlWithoutHash,\n      productSrc,\n      logoSrc\n    });\n  }\n\n};\nemailTemplates.resetPassword = {\n  subject() {\n    return \"Restablece tu contrase\\xF1a\";\n  },\n\n  html(user, url) {\n    const urlWithoutHash = url.replace('#/', '');\n    if (Meteor.isDevelopment) console.info('Password reset link: ', urlWithoutHash);\n    SSR.compileTemplate('emailResetPassword', Assets.getText(emailResetPassword));\n    return SSR.render('emailResetPassword', {\n      urlWithoutHash,\n      productSrc,\n      logoSrc\n    });\n  }\n\n};\nemailTemplates.verifyEmail = {\n  subject() {\n    return \"Verifica tu correo\";\n  },\n\n  html(user, url) {\n    const urlWithoutHash = url.replace('#/', '');\n    if (Meteor.isDevelopment) console.info('Verify email link: ', urlWithoutHash);\n    SSR.compileTemplate('emailVerifyEmail', Assets.getText(emailVerifyEmail));\n    return SSR.render('emailVerifyEmail', {\n      urlWithoutHash,\n      productSrc,\n      logoSrc\n    });\n  }\n\n};\n\nif (Meteor.isDevelopment) {\n  var _Meteor$settings$priv2;\n\n  if ((_Meteor$settings$priv2 = Meteor.settings.private) !== null && _Meteor$settings$priv2 !== void 0 && _Meteor$settings$priv2.MAIL_URL) {\n    process.env.MAIL_URL = Meteor.settings.private.MAIL_URL;\n  } else {\n    console.warn('[Meteor + Vue] - Email settings are not configured, Emails will not be send');\n  }\n}\n\n;\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"utilities\":{\"ResponseMessage.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/startup/server/utilities/ResponseMessage.js                                                         //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.export({\n  ResponseMessage: () => ResponseMessage\n});\n\nclass ResponseMessage {\n  constructor() {\n    this.message = null;\n    this.description = null;\n    this.data = null;\n  }\n\n  create(message) {\n    let description = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    let data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    this.message = message;\n    this.description = description;\n    this.data = data;\n  }\n\n}\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"Permissions.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/startup/server/Permissions.js                                                                       //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.export({\n  permissionsArray: () => permissionsArray\n});\nconst Permissions = {\n  USERS: {\n    LIST: {\n      VALUE: 'users-view',\n      TEXT: 'Listar usuarios'\n    },\n    CREATE: {\n      VALUE: 'users-create',\n      TEXT: 'Crear usuario'\n    },\n    UPDATE: {\n      VALUE: 'users-edit',\n      TEXT: 'Actualizar usuario'\n    },\n    DELETE: {\n      VALUE: 'users-delete',\n      TEXT: 'Eliminar usuario'\n    }\n  },\n  PROFILES: {\n    LIST: {\n      VALUE: 'profiles-view',\n      TEXT: 'Listar perfiles'\n    },\n    CREATE: {\n      VALUE: 'profiles-create',\n      TEXT: 'Crear perfil'\n    },\n    UPDATE: {\n      VALUE: 'profiles-edit',\n      TEXT: 'Actualizar perfil'\n    },\n    DELETE: {\n      VALUE: 'profiles-delete',\n      TEXT: 'Eliminar perfil'\n    }\n  },\n  PERMISSIONS: {\n    LIST: {\n      VALUE: 'permissions-view',\n      TEXT: 'Listar permisos'\n    }\n  }\n};\nconst permissionsArray = Object.keys(Permissions).reduce((accumulator, systemModuleName) => {\n  const systemModuleObject = Permissions[systemModuleName];\n  const modulePermissions = Object.keys(systemModuleObject).map(permission => systemModuleObject[permission]);\n  return accumulator.concat(modulePermissions);\n}, []);\n\nif (Meteor.isDevelopment) {\n  if (Meteor.settings.private && Meteor.settings.private.REFRESH_PERMISSIONS) {\n    console.log('uplading permissions. . .');\n    const currentRoles = Roles.getAllRoles().fetch();\n\n    for (let permission of permissionsArray) {\n      if (!currentRoles.find(_role => _role._id === permission.VALUE)) {\n        Roles.createRole(permission.VALUE);\n      }\n\n      Meteor.roles.update(permission.VALUE, {\n        $set: {\n          publicName: permission.TEXT\n        }\n      });\n    }\n  }\n}\n\nmodule.exportDefault(Permissions);\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"index.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/startup/server/index.js                                                                             //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.link(\"./Permissions\");\nmodule.link(\"./services/MailServ\");\nmodule.link(\"./services/FirebaseAdmin\");\nmodule.link(\"../../api/Users/User\");\nmodule.link(\"../../api/Users/UsersCtrl\");\nmodule.link(\"../../api/Users/UsersPubs\");\nmodule.link(\"../../api/Profiles/ProfileSeeder\");\nmodule.link(\"../../api/Profiles/ProfilesCtrl\");\nmodule.link(\"../../api/Profiles/ProfilesPubs\");\nmodule.link(\"../../api/Permissions/PermissionsCtrl\");\nmodule.link(\"../../api/Permissions/PermissionsPubs\");\nmodule.link(\"../../api/SystemOptions/SystemOptionsCtrl\");\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"both\":{\"index.js\":function module(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/startup/both/index.js                                                                               //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nAccounts.config({\n  loginExpirationInDays: 30\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},\"api\":{\"Permissions\":{\"PermissionsCtrl.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Permissions/PermissionsCtrl.js                                                                  //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nlet Permissions;\nmodule.link(\"../../startup/server/Permissions\", {\n  default(v) {\n    Permissions = v;\n  }\n\n}, 0);\nlet ResponseMessage;\nmodule.link(\"../../startup/server/utilities/ResponseMessage\", {\n  ResponseMessage(v) {\n    ResponseMessage = v;\n  }\n\n}, 1);\nlet AuthGuard;\nmodule.link(\"../../middlewares/AuthGuard\", {\n  default(v) {\n    AuthGuard = v;\n  }\n\n}, 2);\nlet check;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  }\n\n}, 3);\nlet Profile;\nmodule.link(\"../Profiles/Profile\", {\n  Profile(v) {\n    Profile = v;\n  }\n\n}, 4);\nnew ValidatedMethod({\n  name: 'permissions.list',\n  mixins: [MethodHooks],\n  permissions: [Permissions.PERMISSIONS.LIST.VALUE],\n  beforeHooks: [AuthGuard.checkPermission],\n  validate: null,\n\n  run() {\n    const responseMessage = new ResponseMessage();\n\n    try {\n      const permissions = Meteor.roles.find().fetch();\n      responseMessage.create('Permisos disponibles del sistema', null, permissions);\n    } catch (error) {\n      console.error('permissions.list: ', error);\n      throw new Meteor.Error('500', 'Ocurrio un error al obtener los permisos');\n    }\n\n    return responseMessage;\n  }\n\n});\nnew ValidatedMethod({\n  name: 'permissions.listByIdProfile',\n  mixins: [MethodHooks],\n  permissions: [Permissions.PERMISSIONS.LIST.VALUE],\n  beforeHooks: [AuthGuard.checkPermission],\n\n  validate(_ref) {\n    let {\n      idProfile\n    } = _ref;\n\n    try {\n      check(idProfile, String);\n    } catch (error) {\n      console.error('permissions.listByIdProfile: ', error);\n      throw new Meteor.Error('403', 'La informacion introducida es valida');\n    }\n  },\n\n  run(_ref2) {\n    let {\n      idProfile\n    } = _ref2;\n    const responseMessage = new ResponseMessage();\n\n    try {\n      const profile = Profile.findOne(idProfile);\n      const permissions = Meteor.roles.find({\n        _id: {\n          $nin: profile.permissions\n        }\n      }).fetch();\n      responseMessage.create('Permisos asociados al perfil.', null, permissions);\n    } catch (error) {\n      console.error('permissions.listByIdProfile: ', error);\n      throw new Meteor.Error('500', 'Ocurrio un error al obtener los permisos del perfil');\n    }\n\n    return responseMessage;\n  }\n\n});\nnew ValidatedMethod({\n  name: 'permissions.listOtherForIdProfile',\n  mixins: [MethodHooks],\n  permissions: [Permissions.PERMISSIONS.LIST.VALUE],\n  beforeHooks: [AuthGuard.checkPermission],\n\n  validate(_ref3) {\n    let {\n      idProfile\n    } = _ref3;\n\n    try {\n      check(idProfile, String);\n    } catch (error) {\n      console.error('permissions.listOtherForIdProfile: ', error);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    }\n  },\n\n  run(_ref4) {\n    let {\n      idProfile\n    } = _ref4;\n    const responseMessage = new ResponseMessage();\n\n    try {\n      const profile = Profile.findOne(idProfile);\n      const permissions = Meteor.roles.find({\n        _id: {\n          $not: {\n            $nin: profile.permissions\n          }\n        }\n      }).fetch();\n      responseMessage.create('Permisos no asociados al perfil.', null, permissions);\n    } catch (error) {\n      console.error('permissions.listOtherForIdProfile: ', error);\n      throw new Meteor.Error('500', 'Ocurrio un error al obtener los permisos no asociados al perfil');\n    }\n\n    return responseMessage;\n  }\n\n});\nnew ValidatedMethod({\n  name: 'permission.check',\n  mixins: [MethodHooks],\n  beforeHooks: [AuthGuard.isUserLogged],\n\n  validate(_ref5) {\n    let {\n      permission\n    } = _ref5;\n\n    try {\n      check(permission, String);\n    } catch (error) {\n      console.error('permissions.listOtherForIdProfile: ', error);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    }\n  },\n\n  run(_ref6) {\n    let {\n      permission\n    } = _ref6;\n    const responseMessage = new ResponseMessage();\n\n    try {\n      const scope = Roles.getScopesForUser(this.userId)[0];\n      const hasPermission = Roles.userIsInRole(this.userId, permission, scope);\n      responseMessage.create(\"El usuario \".concat(hasPermission ? 'si' : 'no', \" tiene el permiso\"), null, {\n        hasPermission\n      });\n    } catch (error) {\n      console.error('permissions.check: ', error);\n      throw new Meteor.Error('500', 'Ocurrio un error al verificar el permiso');\n    }\n\n    return responseMessage;\n  }\n\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"PermissionsPubs.js\":function module(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Permissions/PermissionsPubs.js                                                                  //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nMeteor.publish('roles', function () {\n  return Meteor.roleAssignment.find({\n    'user._id': this.userId\n  });\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"Profiles\":{\"Profile.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Profiles/Profile.js                                                                             //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.export({\n  Profile: () => Profile\n});\nlet Mongo;\nmodule.link(\"meteor/mongo\", {\n  Mongo(v) {\n    Mongo = v;\n  }\n\n}, 0);\nconst Profile = new Mongo.Collection('profiles');\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"ProfileSeeder.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Profiles/ProfileSeeder.js                                                                       //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.export({\n  StaticProfiles: () => StaticProfiles\n});\nlet Permissions, permissionsArray;\nmodule.link(\"../../startup/server/Permissions\", {\n  default(v) {\n    Permissions = v;\n  },\n\n  permissionsArray(v) {\n    permissionsArray = v;\n  }\n\n}, 0);\nlet Profile;\nmodule.link(\"./Profile\", {\n  Profile(v) {\n    Profile = v;\n  }\n\n}, 1);\nProfile.rawCollection().createIndex({\n  'name': 1\n}, {\n  unique: true\n});\nconst StaticProfiles = {\n  admin: {\n    name: 'admin',\n    description: 'Administrador',\n    permissions: permissionsArray.map(p => p.VALUE)\n  }\n};\n\nif (Meteor.isDevelopment) {\n  if (Meteor.settings.private && Meteor.settings.private.REFRESH_STATIC_PROFILES) {\n    console.log('updating static profiles. . .');\n    Object.keys(StaticProfiles).forEach(staticProfileName => {\n      Profile.upsert({\n        name: StaticProfiles[staticProfileName].name\n      }, {\n        $set: {\n          description: StaticProfiles[staticProfileName].description,\n          permissions: StaticProfiles[staticProfileName].permissions\n        }\n      });\n      Meteor.users.find({\n        'profile.profile': StaticProfiles[staticProfileName].name\n      }).fetch().forEach(user => {\n        Meteor.roleAssignment.remove({\n          'user._id': user._id\n        });\n\n        if (StaticProfiles[staticProfileName].permissions.length > 0) {\n          Roles.setUserRoles(user._id, StaticProfiles[staticProfileName].permissions, StaticProfiles[staticProfileName].name);\n        }\n      });\n    });\n  }\n}\n\n;\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"ProfilesCtrl.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Profiles/ProfilesCtrl.js                                                                        //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 0);\nlet AuthGuard;\nmodule.link(\"../../middlewares/AuthGuard\", {\n  default(v) {\n    AuthGuard = v;\n  }\n\n}, 1);\nlet Permissions;\nmodule.link(\"../../startup/server/Permissions\", {\n  default(v) {\n    Permissions = v;\n  }\n\n}, 2);\nlet ResponseMessage;\nmodule.link(\"../../startup/server/utilities/ResponseMessage\", {\n  ResponseMessage(v) {\n    ResponseMessage = v;\n  }\n\n}, 3);\nlet Profile;\nmodule.link(\"./Profile\", {\n  Profile(v) {\n    Profile = v;\n  }\n\n}, 4);\nlet ProfilesServ;\nmodule.link(\"./ProfilesServ\", {\n  default(v) {\n    ProfilesServ = v;\n  }\n\n}, 5);\nnew ValidatedMethod({\n  name: 'profile.save',\n  mixins: [MethodHooks],\n  permissions: [Permissions.PROFILES.CREATE.VALUE, Permissions.PROFILES.UPDATE.VALUE],\n  beforeHooks: [AuthGuard.checkPermission],\n\n  validate(profile) {\n    try {\n      check(profile, {\n        _id: Match.OneOf(String, null),\n        name: String,\n        description: String,\n        permissions: [String]\n      });\n    } catch (error) {\n      console.error('profile.save', error);\n      throw new Meteor.Error('403', 'La informacion no es valida');\n    }\n\n    ProfilesServ.validateName(profile.name, profile._id);\n  },\n\n  run(profile) {\n    const responseMessage = new ResponseMessage();\n\n    if (profile._id !== null) {\n      try {\n        // UPDATE PROFILE\n        const oldProfile = Profile.findOne(profile._id);\n        const users = ProfilesServ.getUsersByProfile(profile._id);\n        Profile.update(profile._id, {\n          $set: {\n            name: profile.name,\n            description: profile.description,\n            permissions: profile.permissions\n          }\n        });\n\n        if (oldProfile.name !== profile.name) {\n          Meteor.users.update({\n            'profile.profile': oldProfile.name\n          }, {\n            $set: {\n              'profile.profile': profile.name\n            }\n          }, {\n            multi: true\n          });\n        }\n\n        ProfilesServ.updateProfileUsers(users, profile);\n        responseMessage.create('Se actualizo el perfil exitosamente');\n      } catch (error) {\n        console.error('profile.save', error);\n        throw new Meteor.Error('500', 'Ocurrio un error al actualizar el perfil');\n      }\n    } else {\n      try {\n        // CREATE PROFILE\n        Profile.insert({\n          name: profile.name,\n          description: profile.description,\n          permissions: profile.permissions\n        });\n        responseMessage.create('Se creo el perfil exitosamente');\n      } catch (error) {\n        console.error('profile.save', error);\n        throw new Meteor.Error('500', 'Ocurrio un error al crear el nuevo perfil');\n      }\n    }\n\n    return responseMessage;\n  }\n\n});\nnew ValidatedMethod({\n  name: 'profile.delete',\n  mixins: [MethodHooks],\n  permissions: [Permissions.PROFILES.DELETE.VALUE],\n  beforeHooks: [AuthGuard.checkPermission],\n\n  validate(_ref) {\n    let {\n      idProfile\n    } = _ref;\n\n    try {\n      check(idProfile, String);\n    } catch (error) {\n      console.error('profile.delete', error);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    }\n\n    const users = ProfilesServ.getUsersByProfile(idProfile);\n\n    if (users.length > 0) {\n      throw new Meteor.Error('403', 'No se puede eliminar perfil.', 'Hay usuarios usando este perfil');\n    }\n  },\n\n  run(_ref2) {\n    let {\n      idProfile\n    } = _ref2;\n    const responseMessage = new ResponseMessage();\n\n    try {\n      Profile.remove(idProfile);\n      responseMessage.create('Perfil eliminado exitosamente');\n    } catch (error) {\n      console.error('profile.delete', error);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    }\n\n    return responseMessage;\n  }\n\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"ProfilesPubs.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Profiles/ProfilesPubs.js                                                                        //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nlet PermissionMiddleware;\nmodule.link(\"../../middlewares/PermissionsMiddleware\", {\n  PermissionMiddleware(v) {\n    PermissionMiddleware = v;\n  }\n\n}, 0);\nlet Permissions;\nmodule.link(\"../../startup/server/Permissions\", {\n  default(v) {\n    Permissions = v;\n  }\n\n}, 1);\nlet Profile;\nmodule.link(\"./Profile\", {\n  Profile(v) {\n    Profile = v;\n  }\n\n}, 2);\nlet ProfilesServ;\nmodule.link(\"./ProfilesServ\", {\n  default(v) {\n    ProfilesServ = v;\n  }\n\n}, 3);\nconst noStaticProfilesPublication = new PublishEndpoint('profile.listNotStaticProfiles', function () {\n  return Profile.find({\n    name: {\n      $nin: ProfilesServ.getStaticProfileName()\n    }\n  });\n});\nconst profilesPublication = new PublishEndpoint('profile.listAll', function () {\n  return Profile.find();\n});\nprofilesPublication.use(new PermissionMiddleware([Permissions.PROFILES.LIST.VALUE]));\nnoStaticProfilesPublication.use(new PermissionMiddleware([Permissions.PROFILES.LIST.VALUE]));\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"ProfilesServ.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Profiles/ProfilesServ.js                                                                        //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nlet Profile;\nmodule.link(\"./Profile\", {\n  Profile(v) {\n    Profile = v;\n  }\n\n}, 0);\nlet StaticProfiles;\nmodule.link(\"./ProfileSeeder\", {\n  StaticProfiles(v) {\n    StaticProfiles = v;\n  }\n\n}, 1);\nmodule.exportDefault({\n  validateName(name, idProfile) {\n    const existName = Profile.findOne({\n      name\n    });\n\n    if (idProfile) {\n      const oldProfile = Profile.findOne(idProfile);\n\n      if (oldProfile.name !== name && existName) {\n        throw new Meteor.Error('403', \"El nuevo nombre de perfil ya se encuentra en uso\");\n      }\n    } else if (existName) {\n      throw new Meteor.Error('403', \"El nombre de perfil ya se encuentra en uso\");\n    }\n  },\n\n  getUsersByProfile(idProfile) {\n    const profile = Profile.findOne(idProfile);\n    return Meteor.users.find({\n      'profile.profile': profile.name\n    }).fetch();\n  },\n\n  setUserRoles(idUser, profileName) {\n    const permissions = Profile.findOne({\n      name: profileName\n    }).permissions;\n    Meteor.roleAssignment.remove({\n      'user._id': idUser\n    });\n    Roles.setUserRoles(idUser, permissions, profileName);\n  },\n\n  updateProfileUsers(users, profile) {\n    users.forEach(user => {\n      this.setUserRoles(user._id, profile.name);\n    });\n  },\n\n  getStaticProfileName() {\n    return Object.keys(StaticProfiles).map(staticProfileName => {\n      return StaticProfiles[staticProfileName].name;\n    });\n  }\n\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"SystemOptions\":{\"SystemOptions.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/SystemOptions/SystemOptions.js                                                                  //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nlet Permissions;\nmodule.link(\"../../startup/server/Permissions\", {\n  default(v) {\n    Permissions = v;\n  }\n\n}, 0);\nmodule.exportDefault([{\n  title: 'Inicio',\n  permission: null,\n  routeName: 'home'\n}, {\n  title: 'Usuarios',\n  permission: Permissions.USERS.LIST.VALUE,\n  routeName: 'home.users'\n}, {\n  title: 'Perfiles',\n  permission: Permissions.PROFILES.LIST.VALUE,\n  routeName: 'home.profiles'\n}]);\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"SystemOptionsCtrl.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/SystemOptions/SystemOptionsCtrl.js                                                              //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nlet SystemOptions;\nmodule.link(\"./SystemOptions\", {\n  default(v) {\n    SystemOptions = v;\n  }\n\n}, 0);\nlet ResponseMessage;\nmodule.link(\"../../startup/server/utilities/ResponseMessage\", {\n  ResponseMessage(v) {\n    ResponseMessage = v;\n  }\n\n}, 1);\nlet AuthGuard;\nmodule.link(\"../../middlewares/AuthGuard\", {\n  default(v) {\n    AuthGuard = v;\n  }\n\n}, 2);\nnew ValidatedMethod({\n  name: 'user.getSystemOptions',\n  mixins: [MethodHooks],\n  beforeHooks: [AuthGuard.isUserLogged],\n  validate: null,\n\n  run() {\n    const responseMessage = new ResponseMessage();\n    const userLogged = Meteor.user();\n    const userRoles = Roles.getRolesForUser(userLogged._id, userLogged.profile.profile);\n    const optionsOfUser = SystemOptions.reduce((accumulator, systemOption) => {\n      if (!systemOption.permission || !!userRoles.find(role => role === systemOption.permission)) {\n        accumulator.push(systemOption);\n      }\n\n      return accumulator;\n    }, []);\n    responseMessage.create('Opciones del sistema de usuario.', null, optionsOfUser);\n    return responseMessage;\n  }\n\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"Users\":{\"User.js\":function module(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Users/User.js                                                                                   //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nMeteor.users.rawCollection().createIndex({\n  'profile.profile': 1\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"UsersCtrl.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Users/UsersCtrl.js                                                                              //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nlet ValidatedMethod;\nmodule.link(\"meteor/mdg:validated-method\", {\n  ValidatedMethod(v) {\n    ValidatedMethod = v;\n  }\n\n}, 0);\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 1);\nlet ResponseMessage;\nmodule.link(\"../../startup/server/utilities/ResponseMessage\", {\n  ResponseMessage(v) {\n    ResponseMessage = v;\n  }\n\n}, 2);\nlet UsersServ;\nmodule.link(\"./UsersServ\", {\n  default(v) {\n    UsersServ = v;\n  }\n\n}, 3);\nlet AuthGuard;\nmodule.link(\"../../middlewares/AuthGuard\", {\n  default(v) {\n    AuthGuard = v;\n  }\n\n}, 4);\nlet Permissions;\nmodule.link(\"../../startup/server/Permissions\", {\n  default(v) {\n    Permissions = v;\n  }\n\n}, 5);\nAccounts.validateLoginAttempt(loginAttempt => {\n  if (loginAttempt.allowed) {\n    var _loginAttempt$user$se;\n\n    if (!loginAttempt.user.emails[0].verified) {\n      throw new Meteor.Error('403', 'El correo de la cuenta no se ha verificado aun.');\n    }\n\n    const loginTokensOfUser = ((_loginAttempt$user$se = loginAttempt.user.services.resume) === null || _loginAttempt$user$se === void 0 ? void 0 : _loginAttempt$user$se.loginTokens) || [];\n\n    if (loginTokensOfUser.length > 1) {\n      Meteor.users.update(loginAttempt.user._id, {\n        $set: {\n          'services.resume.loginTokens': [loginTokensOfUser.pop()]\n        }\n      });\n    }\n\n    return true;\n  }\n});\nnew ValidatedMethod({\n  name: 'user.save',\n  mixins: [MethodHooks],\n  permissions: [Permissions.USERS.CREATE.VALUE, Permissions.USERS.UPDATE.VALUE],\n  beforeHooks: [AuthGuard.checkPermission],\n\n  validate(user) {\n    try {\n      check(user, {\n        _id: Match.OneOf(String, null),\n        username: String,\n        emails: [{\n          address: String,\n          verified: Boolean\n        }],\n        profile: {\n          profile: String,\n          name: String,\n          path: Match.OneOf(String, null)\n        }\n      });\n    } catch (error) {\n      console.log('save.user', error);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    }\n\n    UsersServ.validateEmail(user.emails[0].address, user._id);\n    UsersServ.validateUsername(user.username, user._id);\n  },\n\n  run(user) {\n    const responseMessage = new ResponseMessage();\n\n    if (user._id !== null) {\n      try {\n        // UPDATE USER \n        UsersServ.updateUser(user);\n        responseMessage.create('Se actualizo el usuario exitosamente');\n      } catch (error) {\n        console.error('user.save', error);\n        throw new Meteor.Error('500', 'Ocurrio un error al actualizar el usuario');\n      }\n    } else {\n      try {\n        // CREATE USER\n        UsersServ.createUser(user);\n        responseMessage.create('Se ha creado usuario exitosamente');\n      } catch (error) {\n        console.error('user.save: ', error);\n        throw new Meteor.Error('500', 'Ocurrió un error al crear un usuario');\n      }\n    }\n\n    return responseMessage;\n  }\n\n});\nnew ValidatedMethod({\n  name: 'user.delete',\n  mixins: [MethodHooks],\n  permissions: [Permissions.USERS.DELETE.VALUE],\n  beforeHooks: [AuthGuard.checkPermission],\n\n  validate(_ref) {\n    let {\n      idUser\n    } = _ref;\n\n    try {\n      check(idUser, String);\n    } catch (error) {\n      console.error('user.delete', error);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    }\n  },\n\n  run(_ref2) {\n    let {\n      idUser\n    } = _ref2;\n    const responseMessage = new ResponseMessage();\n\n    try {\n      Meteor.users.remove(idUser);\n      Meteor.roleAssignment.remove({\n        'user._id': idUser\n      });\n      responseMessage.create('Se ha eliminado exitosamente al usuario');\n    } catch (error) {\n      console.error('user.delete', error);\n      throw new Meteor.Error('500', 'Ocurrio un error al eliminar un usuario');\n    }\n\n    return responseMessage;\n  }\n\n});\nnew ValidatedMethod({\n  name: 'user.updatePersonalData',\n  mixins: [MethodHooks],\n  beforeHooks: [AuthGuard.isUserLogged],\n\n  validate(user) {\n    try {\n      check(user, {\n        _id: Match.OneOf(String, null),\n        username: String,\n        emails: [{\n          address: String,\n          verified: Boolean\n        }],\n        profile: {\n          profile: String,\n          name: String,\n          path: Match.OneOf(String, null)\n        }\n      });\n    } catch (error) {\n      console.log('user.updatePersonalData', error);\n      throw new Meteor.Error('403', 'La informacion introducida no es valida');\n    }\n\n    UsersServ.validateEmail(user.emails[0].address, user._id);\n    UsersServ.validateUsername(user.username, user._id);\n  },\n\n  run(user) {\n    const responseMessage = new ResponseMessage();\n\n    try {\n      // UPDATE USER \n      UsersServ.updateUser(user);\n      responseMessage.create('Se actualizo la informacion exitosamente');\n    } catch (error) {\n      console.error('user.updatePersonalData', error);\n      throw new Meteor.Error('500', 'Ocurrio un error al actualizar la informacion');\n    }\n\n    return responseMessage;\n  }\n\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"UsersPubs.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Users/UsersPubs.js                                                                              //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet PublishEndpoint;\nmodule.link(\"meteor/peerlibrary:middleware\", {\n  PublishEndpoint(v) {\n    PublishEndpoint = v;\n  }\n\n}, 1);\nlet PermissionMiddleware;\nmodule.link(\"../../middlewares/PermissionsMiddleware\", {\n  PermissionMiddleware(v) {\n    PermissionMiddleware = v;\n  }\n\n}, 2);\nlet Permissions;\nmodule.link(\"../../startup/server/Permissions\", {\n  default(v) {\n    Permissions = v;\n  }\n\n}, 3);\nconst usersPublication = new PublishEndpoint('user.list', function () {\n  return Meteor.users.find({}, {\n    sort: {\n      createdAt: -1\n    }\n  });\n});\nusersPublication.use(new PermissionMiddleware([Permissions.USERS.LIST.VALUE]));\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"UsersServ.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/Users/UsersServ.js                                                                              //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nlet ProfilesServ;\nmodule.link(\"../Profiles/ProfilesServ\", {\n  default(v) {\n    ProfilesServ = v;\n  }\n\n}, 0);\nmodule.exportDefault({\n  validateEmail(newEmail, idUser) {\n    const existEmail = Accounts.findUserByEmail(newEmail);\n\n    if (idUser) {\n      const oldUser = Meteor.users.findOne(idUser);\n\n      if (oldUser.emails[0].address !== newEmail && existEmail) {\n        throw new Meteor.Error('403', 'El nuevo email ya se encuentra en uso');\n      }\n    } else if (existEmail) {\n      throw new Meteor.Error('403', 'El nuevo email ya se encuetra en uso');\n    }\n  },\n\n  validateUsername(newUsername, idUser) {\n    const existUsername = Accounts.findUserByUsername(newUsername);\n\n    if (idUser) {\n      const oldUser = Meteor.users.findOne(idUser);\n\n      if (oldUser.username !== newUsername && existUsername) {\n        throw new Meteor.Error('403', \"El nuevo nombre de usuario ya se encuentra en uso\");\n      }\n    } else if (existUsername) {\n      throw new Meteor.Error('403', \"El nombre de usuario ya se encuentra en uso\");\n    }\n  },\n\n  createUser(user) {\n    const idUser = Accounts.createUser({\n      username: user.username,\n      email: user.emails[0].address,\n      profile: user.profile\n    });\n\n    if (idUser) {\n      ProfilesServ.setUserRoles(idUser, user.profile.profile);\n      Accounts.sendEnrollmentEmail(idUser, user.emails[0].address);\n    }\n  },\n\n  updateUser(user) {\n    const currentUser = Meteor.users.findOne(user._id);\n\n    if (currentUser.emails[0].address !== user.emails[0].address) {\n      Accounts.removeEmail(currentUser._id, currentUser.emails[0].address);\n      Accounts.addEmail(currentUser._id, user.emails[0].address);\n      Accounts.sendVerificationEmail(user._id, user.emails[0].address);\n    }\n\n    if (currentUser.username !== user.username) {\n      Accounts.setUsername(currentUser._id, user.username);\n    }\n\n    Meteor.users.update(user._id, {\n      $set: {\n        profile: {\n          profile: user.profile.profile,\n          name: user.profile.name,\n          path: user.profile.path\n        }\n      }\n    });\n    ProfilesServ.setUserRoles(user._id, user.profile.profile);\n  }\n\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},\"middlewares\":{\"AuthGuard.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/middlewares/AuthGuard.js                                                                            //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nconst checkPermission = function (methodArgs, methodOptions) {\n  const idUser = this.userId;\n  const permissions = methodOptions.permissions;\n  let hasPermission = false;\n\n  if (idUser !== null) {\n    const profileName = Meteor.user().profile.profile;\n    hasPermission = Roles.userIsInRole(idUser, permissions, profileName);\n  }\n\n  if (!hasPermission) {\n    throw new Meteor.Error('403', 'Acceso denegado', 'No tienes permiso para ejecutar esta accion');\n  }\n\n  return methodArgs;\n};\n\nconst isUserLogged = function (methodArgs, methodOptions) {\n  if (!this.userId) {\n    throw new Meteor.Error('403', 'Acceso denegado', 'No tienes permiso para ejecutar esta accion');\n  }\n\n  return methodArgs;\n};\n\nmodule.exportDefault({\n  checkPermission,\n  isUserLogged\n});\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"PermissionsMiddleware.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/middlewares/PermissionsMiddleware.js                                                                //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.export({\n  PermissionMiddleware: () => PermissionMiddleware\n});\n\nclass PermissionMiddleware extends PublishMiddleware {\n  constructor(permissions) {\n    super();\n    this._permissions = permissions;\n  }\n\n  added(publish, collection, id, fields) {\n    if (publish.userId) {\n      return super.added(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  change(publish, collection, id, fields) {\n    if (this.checkPermission(publish.userId)) {\n      return super.changed(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  removed(publish, collection, id) {\n    if (this.checkPermission(publish.userId)) {\n      return super.removed(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  onReady(publish) {\n    if (publish.userId) {\n      return super.onReady(...arguments);\n    }\n  }\n\n  onStop(publish) {\n    if (publish.userId) {\n      return super.onStop(...arguments);\n    }\n  }\n\n  onError(publish) {\n    if (publish.userId) {\n      return super.onError(...arguments);\n    }\n  }\n\n  checkPermission(idUser) {\n    const profileName = Roles.getScopesForUser(idUser)[0];\n    return Roles.userIsInRole(idUser, this._permissions, profileName);\n  }\n\n}\n\n;\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},\"server\":{\"main.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// server/main.js                                                                                              //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.link(\"/imports/startup/server\");\nmodule.link(\"/imports/startup/both\");\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"settings\":{\"meteor-vue-fb643-firebase-adminsdk-50cu3-4c287411da.json\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// settings/meteor-vue-fb643-firebase-adminsdk-50cu3-4c287411da.json                                           //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.exports = {\n  \"type\": \"service_account\",\n  \"project_id\": \"meteor-vue-fb643\",\n  \"private_key_id\": \"4c287411dad90a48a241628463b1be3ae291fc75\",\n  \"private_key\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC2PqG7w4cQD6a1\\nPEAJfZOO/V83SpAifGcvVQznUrh+KfNg29X4EFQ8lpETl24CCzvJZfUqXqymp3wI\\n5+UaTPf9/VhMYNBHf0VTzfaRRW1Zhr4I1AeZLhgNbLGBCstaTgyaXUCWn4cNzAOg\\nt3vm695uSq7afpRRa0C7RL852fDy6zxQMvg53LJdS1iUZp5+73YG/80X4lkSQc3n\\nQ8C2xcPXeG6JXF+vhZMn9wc8KVhr5/EnppF3UGlaR4D21K0cW16OixvV7EuTGfEW\\nxUZtv6CeE692y2I3nQZw0t1aSpwpmJM540VgUmETGq8JXThAloBe1bAP8xhfijc9\\nbNP7UYwlAgMBAAECggEAE1hT+VxoqoR0IRTY2f5h0ByGeOtfSr8t13u4YkMI9nYk\\nMYnkYpqednf9GmPz93ToecPANykpkTSCGWfpjSsnv+bz8oJBrvU25LhzjeQdbBK+\\nJVhsc2QjMCRI4KEcCOVJYoa3jnA3TnhI16Hicxa327lDFPUOxWhpzKHK3Vc3GRyV\\na6Qh7C+uoaKRbLZs9QsHN2LFX3ZNQ2kkjr5PWIqtTYKaiifZ5ppYBErH9aV5+xyH\\nbg+vz6DY7gDiX3qGg+u/LrsmTDgJOhtft6wv3FDZUg948P56RSRiWv4f33vrq+8V\\nYdlvpE+b9X/xL1u9Wh48eAlXoCrpFWSQP74dsq+n2QKBgQDd3gNx81NqzXT3GEqT\\nIqeEphrlqSkVRL9X/us+N+qEP198u7mCKTY5morocTSwazMnwtSeGxlhIb59FywH\\nzRVr0lJLEmSyWlNmno3E2/jwBbtKNbi6zc0mkYh+ev0VskNa60RPhjM2jG0KgqO1\\n0M1D7RTzWB1GqtvWYActNxOsIwKBgQDSSCDYbJnoQKA47xmzjXIB0yTbkxfiwvIP\\nwdJisbZOxedWXCIKmWl6n7HIw9ZfN35m7AECX/5KrGkbzem7Rk8hxYg9S7L36chD\\nwITArIPsw+Lrh5oBC7Rd/m313JZYX9PCyPwt5PGZRodSXfdUo51TRj0U+w9aBgU8\\n3Smwc7lnFwKBgDwVZ7FwR+LgiRBxj6CQ/fS6VwZi7TFJUNgvvN04n1X5I47P98j8\\nCCdJZtzT64TrQws9g/7dL95SGRgfMllafLaaWpbiAEsckwFzZsktGRlHNBVAvyo3\\nmZscRm6aN/esMvloRTOUEEJxfQYfot4WEcCXb9kGv8bndmlzz/26sKUpAoGAVOsv\\n6HajCLngel2EgZAjdD0ya0HRqY+UdWyOa7DcsJ8XNzbpwGIHyK9o+myry7P7ZdD0\\n72KYrMtHfyT+uNRB7J96z1YcpiVQ7Jt4gN6qQBkzMG6IcNerNTIkcd9tD69TMxw7\\nSsVkE8P5rfeohBO22wRIcoqYvoAj6VpfFZUGUG0CgYEA0msmpy4Bo+UIaUix0hyW\\nBV0rAVNC8r/YxH2AE23QHriDPrdZPKC8IauxxOSYkyu+tt4tplCfqDiT5jZr2Kzo\\nXKkHGRB2zBL69UM+EsdTTqubzAgaiwOlFOb3PJVzuS8xtWQCCYHvINp27umdhdVi\\n7CY4VXUrjDBvHatNawnFuk4=\\n-----END PRIVATE KEY-----\\n\",\n  \"client_email\": \"firebase-adminsdk-50cu3@meteor-vue-fb643.iam.gserviceaccount.com\",\n  \"client_id\": \"110615919374658839855\",\n  \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\",\n  \"token_uri\": \"https://oauth2.googleapis.com/token\",\n  \"auth_provider_x509_cert_url\": \"https://www.googleapis.com/oauth2/v1/certs\",\n  \"client_x509_cert_url\": \"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-50cu3%40meteor-vue-fb643.iam.gserviceaccount.com\"\n};\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\",\n    \".ts\",\n    \".mjs\",\n    \".vue\"\n  ]\n});\n\nvar exports = require(\"/server/main.js\");","hash":"8d3f66259b6cb936030f5562c49de18c6312e14a","servePath":"/app.js","sourceMap":{"version":3,"sources":["imports/startup/server/services/FirebaseAdmin.js","imports/startup/server/services/MailServ.js","imports/startup/server/utilities/ResponseMessage.js","imports/startup/server/Permissions.js","imports/startup/server/index.js","imports/startup/both/index.js","imports/api/Permissions/PermissionsCtrl.js","imports/api/Permissions/PermissionsPubs.js","imports/api/Profiles/Profile.js","imports/api/Profiles/ProfileSeeder.js","imports/api/Profiles/ProfilesCtrl.js","imports/api/Profiles/ProfilesPubs.js","imports/api/Profiles/ProfilesServ.js","imports/api/SystemOptions/SystemOptions.js","imports/api/SystemOptions/SystemOptionsCtrl.js","imports/api/Users/User.js","imports/api/Users/UsersCtrl.js","imports/api/Users/UsersPubs.js","imports/api/Users/UsersServ.js","imports/middlewares/AuthGuard.js","imports/middlewares/PermissionsMiddleware.js","server/main.js"],"names":["module","export","firebaseAdminStorage","BASE_URL_STORAGE","firebaseAdmin","link","default","v","serviceAccount","initializeApp","credential","cert","storageBucket","storage","bucket","Meteor","isDevelopment","settings","private","SENDER_EMAILS","process","env","EMAIL_SERVICES","SERVICES","console","warn","name","email","from","Accounts","emailTemplates","siteName","emailEnrollAccount","emailResetPassword","emailVerifyEmail","productSrc","logoSrc","enrollAccount","subject","html","user","url","urlWithoutHash","replace","info","SSR","compileTemplate","Assets","getText","render","resetPassword","verifyEmail","MAIL_URL","ResponseMessage","constructor","message","description","data","create","permissionsArray","Permissions","USERS","LIST","VALUE","TEXT","CREATE","UPDATE","DELETE","PROFILES","PERMISSIONS","Object","keys","reduce","accumulator","systemModuleName","systemModuleObject","modulePermissions","map","permission","concat","REFRESH_PERMISSIONS","log","currentRoles","Roles","getAllRoles","fetch","find","_role","_id","createRole","roles","update","$set","publicName","exportDefault","config","loginExpirationInDays","AuthGuard","check","Profile","ValidatedMethod","mixins","MethodHooks","permissions","beforeHooks","checkPermission","validate","run","responseMessage","error","Error","idProfile","String","profile","findOne","$nin","$not","isUserLogged","scope","getScopesForUser","userId","hasPermission","userIsInRole","publish","roleAssignment","Mongo","Collection","StaticProfiles","rawCollection","createIndex","unique","admin","p","REFRESH_STATIC_PROFILES","forEach","staticProfileName","upsert","users","remove","length","setUserRoles","Match","ProfilesServ","OneOf","validateName","oldProfile","getUsersByProfile","multi","updateProfileUsers","insert","PermissionMiddleware","noStaticProfilesPublication","PublishEndpoint","getStaticProfileName","profilesPublication","use","existName","idUser","profileName","title","routeName","SystemOptions","userLogged","userRoles","getRolesForUser","optionsOfUser","systemOption","role","push","UsersServ","validateLoginAttempt","loginAttempt","allowed","emails","verified","loginTokensOfUser","services","resume","loginTokens","pop","username","address","Boolean","path","validateEmail","validateUsername","updateUser","createUser","usersPublication","sort","createdAt","newEmail","existEmail","findUserByEmail","oldUser","newUsername","existUsername","findUserByUsername","sendEnrollmentEmail","currentUser","removeEmail","addEmail","sendVerificationEmail","setUsername","methodArgs","methodOptions","PublishMiddleware","_permissions","added","collection","id","fields","arguments","ready","change","changed","removed","onReady","onStop","onError"],"mappings":"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","file":"/app.js","sourcesContent":["import firebaseAdmin from 'firebase-admin';\r\nimport serviceAccount from '../../../../settings/meteor-vue-fb643-firebase-adminsdk-50cu3-4c287411da.json';\r\n\r\nfirebaseAdmin.initializeApp({\r\n    credential: firebaseAdmin.credential.cert(serviceAccount),\r\n    storageBucket: 'meteor-vue-fb643.appspot.com'\r\n});\r\n\r\nexport const firebaseAdminStorage = firebaseAdmin.storage().bucket();\r\n\r\nexport const BASE_URL_STORAGE = 'https://storage.googleapis.com';","if (Meteor.isDevelopment) {\r\n    if (Meteor.settings.private?.SENDER_EMAILS) {\r\n        process.env.EMAIL_SERVICES = Meteor.settings.private.SENDER_EMAILS.SERVICES;\r\n        } else {\r\n        console.warn('[Meteor + Vue] - Sender emails are not configured, Emails will not be send');\r\n    }\r\n}\r\n\r\nconst name = 'Scaffold Metor + Vue';\r\nconst email = `<${process.env.EMAIL_SERVICES}>`;\r\nconst from = `${name} ${email}`;\r\n\r\nAccounts.emailTemplates.siteName = name;\r\nAccounts.emailTemplates.from = from;\r\nconst emailTemplates = Accounts.emailTemplates;\r\n\r\nconst emailEnrollAccount = 'email_enroll_account.html';\r\nconst emailResetPassword = 'email_reset_password.html';\r\nconst emailVerifyEmail = 'email_verify_email.html';\r\n\r\nconst productSrc = 'http://localhost:3000/img/vue-meteor.png'\r\nconst logoSrc = 'http://localhost:3000/img/PoweredDark.png'\r\n\r\nemailTemplates.enrollAccount = {\r\n    subject() {\r\n        return `Bienvenido a ${name}`;\r\n    },\r\n    html (user, url) {\r\n        const urlWithoutHash = url.replace('#/', '');\r\n        if (Meteor.isDevelopment) console.info('Set initial password link: ', urlWithoutHash);\r\n        SSR.compileTemplate('emailEnrollAccount', Assets.getText(emailEnrollAccount));\r\n        return SSR.render('emailEnrollAccount', {\r\n            urlWithoutHash,\r\n            productSrc,\r\n            logoSrc\r\n        });\r\n    }\r\n};\r\n\r\nemailTemplates.resetPassword = {\r\n    subject() {\r\n        return `Restablece tu contraseña`;\r\n    },\r\n    html (user, url) {\r\n        const urlWithoutHash = url.replace('#/', '');\r\n        if (Meteor.isDevelopment) console.info('Password reset link: ', urlWithoutHash);\r\n        SSR.compileTemplate('emailResetPassword', Assets.getText(emailResetPassword));\r\n        return SSR.render('emailResetPassword', {\r\n            urlWithoutHash,\r\n            productSrc,\r\n            logoSrc\r\n        });\r\n    }\r\n};\r\n\r\nemailTemplates.verifyEmail = {\r\n    subject() {\r\n        return `Verifica tu correo`;\r\n    },\r\n    html (user, url) {\r\n        const urlWithoutHash = url.replace('#/', '');\r\n        if (Meteor.isDevelopment) console.info('Verify email link: ', urlWithoutHash);\r\n        SSR.compileTemplate('emailVerifyEmail', Assets.getText(emailVerifyEmail));\r\n        return SSR.render('emailVerifyEmail', {\r\n            urlWithoutHash,\r\n            productSrc,\r\n            logoSrc\r\n        });\r\n    }\r\n};\r\n\r\nif (Meteor.isDevelopment) {\r\n    if (Meteor.settings.private?.MAIL_URL) {\r\n        process.env.MAIL_URL = Meteor.settings.private.MAIL_URL;\r\n        } else {\r\n        console.warn('[Meteor + Vue] - Email settings are not configured, Emails will not be send');\r\n    }\r\n};","export class ResponseMessage {\r\n    constructor(){\r\n        this.message = null;\r\n        this.description = null;\r\n        this.data = null;\r\n    }\r\n    \r\n    create(message, description = null, data = null){\r\n        this.message = message;\r\n        this.description = description;\r\n        this.data = data;\r\n    }\r\n}","const Permissions = { \r\n    USERS: {\r\n        LIST: {VALUE: 'users-view', TEXT: 'Listar usuarios'},\r\n        CREATE: {VALUE: 'users-create', TEXT: 'Crear usuario'},\r\n        UPDATE: {VALUE: 'users-edit', TEXT: 'Actualizar usuario'},\r\n        DELETE: {VALUE: 'users-delete', TEXT: 'Eliminar usuario'}\r\n    }, \r\n    PROFILES: {\r\n        LIST: {VALUE: 'profiles-view', TEXT: 'Listar perfiles'},\r\n        CREATE: {VALUE: 'profiles-create', TEXT: 'Crear perfil'},\r\n        UPDATE: {VALUE: 'profiles-edit', TEXT: 'Actualizar perfil'},\r\n        DELETE: {VALUE: 'profiles-delete', TEXT: 'Eliminar perfil'}\r\n    },\r\n    PERMISSIONS: {\r\n        LIST: {VALUE: 'permissions-view', TEXT: 'Listar permisos'}\r\n    }\r\n};\r\n\r\nexport const permissionsArray = Object.keys(Permissions).reduce((accumulator, systemModuleName) => {\r\n    const systemModuleObject = Permissions[systemModuleName];\r\n    const modulePermissions = Object.keys(systemModuleObject).map(permission => systemModuleObject[permission]);\r\n    return accumulator.concat(modulePermissions);\r\n}, []);\r\n\r\nif (Meteor.isDevelopment) {\r\n    if (Meteor.settings.private && Meteor.settings.private.REFRESH_PERMISSIONS) {\r\n        console.log('uplading permissions. . .');\r\n        const currentRoles = Roles.getAllRoles().fetch();\r\n        for (let permission of permissionsArray) {\r\n            if (!currentRoles.find(_role => _role._id === permission.VALUE)) {\r\n                Roles.createRole(permission.VALUE);\r\n            }\r\n            Meteor.roles.update(permission.VALUE, {\r\n                $set: {\r\n                    publicName: permission.TEXT\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\nexport default Permissions;","import './Permissions';\r\n\r\nimport './services/MailServ';\r\nimport './services/FirebaseAdmin';\r\n\r\nimport '../../api/Users/User';\r\nimport '../../api/Users/UsersCtrl';\r\nimport '../../api/Users/UsersPubs'; \r\n\r\nimport '../../api/Profiles/ProfileSeeder';\r\nimport '../../api/Profiles/ProfilesCtrl';\r\nimport '../../api/Profiles/ProfilesPubs';\r\n\r\nimport '../../api/Permissions/PermissionsCtrl';\r\nimport '../../api/Permissions/PermissionsPubs';\r\n\r\nimport '../../api/SystemOptions/SystemOptionsCtrl';","Accounts.config( {\r\n    loginExpirationInDays: 30\r\n})","import Permissions from '../../startup/server/Permissions';\r\nimport { ResponseMessage } from '../../startup/server/utilities/ResponseMessage';\r\nimport AuthGuard from '../../middlewares/AuthGuard';\r\nimport { check } from 'meteor/check';\r\nimport { Profile } from '../Profiles/Profile';\r\n\r\nnew ValidatedMethod({\r\n    name: 'permissions.list',\r\n    mixins: [MethodHooks],\r\n    permissions: [Permissions.PERMISSIONS.LIST.VALUE],\r\n    beforeHooks: [AuthGuard.checkPermission],\r\n    validate:null,\r\n    run() {\r\n        const responseMessage = new ResponseMessage();\r\n        try {\r\n            const permissions = Meteor.roles.find().fetch();\r\n            responseMessage.create('Permisos disponibles del sistema', null, permissions);\r\n        } catch (error) {\r\n            console.error('permissions.list: ', error);\r\n            throw new Meteor.Error('500', 'Ocurrio un error al obtener los permisos');\r\n        }\r\n        return responseMessage;\r\n    }\r\n});\r\n\r\nnew ValidatedMethod({\r\n    name: 'permissions.listByIdProfile',\r\n    mixins: [MethodHooks],\r\n    permissions: [Permissions.PERMISSIONS.LIST.VALUE],\r\n    beforeHooks: [AuthGuard.checkPermission],\r\n    validate({ idProfile }) {\r\n        try {\r\n            check(idProfile, String);\r\n        } catch (error) {\r\n            console.error('permissions.listByIdProfile: ', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida es valida');\r\n        }\r\n    },\r\n    run({ idProfile }) {\r\n        const responseMessage = new ResponseMessage();\r\n        try {\r\n            const profile = Profile.findOne(idProfile);\r\n            const permissions = Meteor.roles.find({ _id: {$nin: profile.permissions} }).fetch();\r\n            responseMessage.create('Permisos asociados al perfil.', null, permissions);\r\n        } catch (error) {\r\n            console.error('permissions.listByIdProfile: ', error);\r\n            throw new Meteor.Error('500', 'Ocurrio un error al obtener los permisos del perfil');\r\n        }\r\n        return responseMessage;\r\n    }\r\n});\r\n\r\nnew ValidatedMethod({\r\n    name: 'permissions.listOtherForIdProfile',\r\n    mixins: [MethodHooks],\r\n    permissions: [Permissions.PERMISSIONS.LIST.VALUE],\r\n    beforeHooks: [AuthGuard.checkPermission],\r\n    validate({ idProfile }) {\r\n        try {\r\n            check(idProfile, String);\r\n        } catch (error) {\r\n            console.error('permissions.listOtherForIdProfile: ', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\r\n        }\r\n    },\r\n    run({ idProfile }) {\r\n        const responseMessage = new ResponseMessage();\r\n        try {\r\n            const profile = Profile.findOne(idProfile);\r\n            const permissions = Meteor.roles.find({ _id: {$not: {$nin: profile.permissions} } }).fetch();\r\n            responseMessage.create('Permisos no asociados al perfil.', null, permissions);\r\n        } catch (error) {\r\n            console.error('permissions.listOtherForIdProfile: ', error);\r\n            throw new Meteor.Error('500', 'Ocurrio un error al obtener los permisos no asociados al perfil');\r\n        }\r\n        return responseMessage;\r\n    }\r\n});\r\n\r\nnew ValidatedMethod({\r\n    name: 'permission.check',\r\n    mixins: [MethodHooks],\r\n    beforeHooks: [AuthGuard.isUserLogged],\r\n    validate({ permission }) {\r\n        try {\r\n            check( permission, String);\r\n        } catch (error) {\r\n            console.error('permissions.listOtherForIdProfile: ', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\r\n        }\r\n    },\r\n    run({ permission }) {\r\n        const responseMessage = new ResponseMessage();\r\n        try {\r\n            const scope = Roles.getScopesForUser(this.userId)[0];\r\n            const hasPermission = Roles.userIsInRole(this.userId, permission, scope);\r\n            responseMessage.create(`El usuario ${ hasPermission ? 'si' : 'no' } tiene el permiso`, null, {hasPermission} );\r\n        } catch (error) {\r\n            console.error('permissions.check: ', error);\r\n            throw new Meteor.Error('500', 'Ocurrio un error al verificar el permiso');\r\n        }\r\n        return responseMessage;\r\n    }\r\n});\r\n","Meteor.publish('roles', function() {\r\n    return Meteor.roleAssignment.find({ 'user._id' : this.userId });\r\n});","import {Mongo} from 'meteor/mongo';\r\n\r\nexport const Profile = new Mongo.Collection('profiles');","import Permissions, {permissionsArray} from \"../../startup/server/Permissions\"\r\nimport { Profile } from \"./Profile\";\r\n\r\nProfile.rawCollection().createIndex({'name': 1}, {unique: true});\r\n\r\nexport const StaticProfiles = {\r\n    admin: {\r\n        name: 'admin',\r\n        description: 'Administrador',\r\n        permissions: permissionsArray.map(p=>p.VALUE)\r\n    }\r\n};\r\n\r\nif (Meteor.isDevelopment) {\r\n    if (Meteor.settings.private && Meteor.settings.private.REFRESH_STATIC_PROFILES) {\r\n        console.log('updating static profiles. . .');\r\n        Object.keys(StaticProfiles).forEach(staticProfileName => {\r\n            Profile.upsert({name: StaticProfiles[staticProfileName].name}, {\r\n                $set: {\r\n                    description: StaticProfiles[staticProfileName].description,\r\n                    permissions: StaticProfiles[staticProfileName].permissions,\r\n                }\r\n            });\r\n            Meteor.users.find({ 'profile.profile': StaticProfiles[staticProfileName].name}).fetch().forEach(user => {\r\n                Meteor.roleAssignment.remove({'user._id': user._id});\r\n                if (StaticProfiles[staticProfileName].permissions.length > 0) {\r\n                    Roles.setUserRoles(user._id, StaticProfiles[staticProfileName].permissions, StaticProfiles[staticProfileName].name);\r\n                }\r\n            })\r\n        });\r\n    }\r\n};","import {check, Match} from 'meteor/check';\r\nimport AuthGuard from '../../middlewares/AuthGuard';\r\nimport Permissions from '../../startup/server/Permissions';\r\nimport { ResponseMessage } from '../../startup/server/utilities/ResponseMessage';\r\nimport {Profile} from './Profile';\r\nimport ProfilesServ from './ProfilesServ';\r\n\r\nnew ValidatedMethod({\r\n    name: 'profile.save',\r\n    mixins: [MethodHooks],\r\n    permissions: [Permissions.PROFILES.CREATE.VALUE, Permissions.PROFILES.UPDATE.VALUE],\r\n    beforeHooks: [AuthGuard.checkPermission],\r\n    validate(profile) {\r\n        try {\r\n            check(profile, {\r\n                _id: Match.OneOf(String, null),\r\n                name: String,\r\n                description: String,\r\n                permissions: [String]\r\n            });\r\n        } catch (error) {\r\n            console.error('profile.save', error);\r\n            throw new Meteor.Error('403', 'La informacion no es valida');\r\n        }\r\n        ProfilesServ.validateName(profile.name, profile._id);\r\n    },\r\n    run(profile) {\r\n        const responseMessage = new ResponseMessage();\r\n        if (profile._id !== null) {\r\n        try {\r\n            // UPDATE PROFILE\r\n            const oldProfile = Profile.findOne(profile._id);\r\n            const users = ProfilesServ.getUsersByProfile(profile._id);\r\n            Profile.update(profile._id, {\r\n                $set: {\r\n                    name: profile.name,\r\n                    description: profile.description,\r\n                    permissions: profile.permissions\r\n                }\r\n            });\r\n            if (oldProfile.name !== profile.name) {\r\n                Meteor.users.update({'profile.profile': oldProfile.name}, {\r\n                    $set: {\r\n                        'profile.profile': profile.name\r\n                    }\r\n                },{ multi:true });\r\n            }\r\n            ProfilesServ.updateProfileUsers(users, profile);\r\n            responseMessage.create('Se actualizo el perfil exitosamente');\r\n        } catch (error) {\r\n            console.error('profile.save', error);\r\n            throw new Meteor.Error('500', 'Ocurrio un error al actualizar el perfil');\r\n        }         \r\n        } else {\r\n            try {\r\n                // CREATE PROFILE\r\n                Profile.insert({\r\n                    name: profile.name,\r\n                    description: profile.description,\r\n                    permissions: profile.permissions\r\n                });\r\n                responseMessage.create('Se creo el perfil exitosamente');\r\n            } catch (error) {\r\n                console.error('profile.save', error);\r\n                throw new Meteor.Error('500', 'Ocurrio un error al crear el nuevo perfil');\r\n            }\r\n        }\r\n        return responseMessage;\r\n    }\r\n});\r\n\r\nnew ValidatedMethod( {\r\n    name: 'profile.delete',\r\n    mixins: [MethodHooks],\r\n    permissions: [Permissions.PROFILES.DELETE.VALUE],\r\n    beforeHooks: [AuthGuard.checkPermission],\r\n    validate({ idProfile }) {\r\n        try {\r\n            check(idProfile, String);\r\n        } catch (error) {\r\n            console.error('profile.delete', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\r\n        }\r\n        const users = ProfilesServ.getUsersByProfile(idProfile);\r\n        if (users.length > 0) {\r\n            throw new Meteor.Error('403', 'No se puede eliminar perfil.', 'Hay usuarios usando este perfil');\r\n        }\r\n    },\r\n    run({ idProfile }) {\r\n        const responseMessage = new ResponseMessage();\r\n        try {\r\n            Profile.remove(idProfile);\r\n            responseMessage.create('Perfil eliminado exitosamente');\r\n        } catch (error) {\r\n            console.error('profile.delete', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\r\n        }\r\n        return responseMessage;\r\n    }\r\n});","import { PermissionMiddleware } from \"../../middlewares/PermissionsMiddleware\";\r\nimport Permissions from \"../../startup/server/Permissions\";\r\nimport { Profile } from \"./Profile\"\r\nimport ProfilesServ from \"./ProfilesServ\";\r\n\r\nconst noStaticProfilesPublication = new PublishEndpoint('profile.listNotStaticProfiles', function() {\r\n    return Profile.find({name: {$nin: ProfilesServ.getStaticProfileName() }});\r\n}); \r\n\r\nconst profilesPublication = new PublishEndpoint('profile.listAll', function() {\r\n    return Profile.find();\r\n}); \r\n\r\nprofilesPublication.use(new PermissionMiddleware([Permissions.PROFILES.LIST.VALUE]));\r\nnoStaticProfilesPublication.use(new PermissionMiddleware([Permissions.PROFILES.LIST.VALUE]));","import { Profile } from \"./Profile\"\r\nimport { StaticProfiles } from \"./ProfileSeeder\";\r\n\r\nexport default {\r\n    validateName(name, idProfile){\r\n        const existName = Profile.findOne({name});\r\n        if (idProfile) {\r\n            const oldProfile = Profile.findOne(idProfile);\r\n            if (oldProfile.name !== name && existName) {\r\n                throw new Meteor.Error('403', \"El nuevo nombre de perfil ya se encuentra en uso\");\r\n            }\r\n        } else if (existName) {\r\n            throw new Meteor.Error('403', \"El nombre de perfil ya se encuentra en uso\");\r\n        }\r\n    },\r\n    getUsersByProfile(idProfile) {\r\n        const profile = Profile.findOne(idProfile);\r\n        return Meteor.users.find({'profile.profile': profile.name}).fetch();\r\n    },\r\n    setUserRoles(idUser, profileName) {\r\n        const permissions = Profile.findOne({name: profileName}).permissions;\r\n        Meteor.roleAssignment.remove({'user._id': idUser});\r\n        Roles.setUserRoles(idUser, permissions, profileName);\r\n    },\r\n    updateProfileUsers(users, profile) {\r\n        users.forEach(user => {\r\n            this.setUserRoles(user._id, profile.name);\r\n        });\r\n    },\r\n    getStaticProfileName() {\r\n        return Object.keys(StaticProfiles).map(staticProfileName => {\r\n            return StaticProfiles[staticProfileName].name;\r\n        });\r\n    }\r\n};","import Permissions from '../../startup/server/Permissions';\r\n\r\nexport default [\r\n    {\r\n        title: 'Inicio',\r\n        permission: null,\r\n        routeName: 'home'\r\n    },\r\n    {\r\n        title: 'Usuarios',\r\n        permission: Permissions.USERS.LIST.VALUE,\r\n        routeName: 'home.users'\r\n    },\r\n    {\r\n        title: 'Perfiles',\r\n        permission: Permissions.PROFILES.LIST.VALUE,\r\n        routeName: 'home.profiles'\r\n    }\r\n\r\n];","import SystemOptions from \"./SystemOptions\";\r\nimport { ResponseMessage } from \"../../startup/server/utilities/ResponseMessage\";\r\nimport AuthGuard from \"../../middlewares/AuthGuard\";\r\n\r\nnew ValidatedMethod({\r\n    name: 'user.getSystemOptions',\r\n    mixins: [MethodHooks],\r\n    beforeHooks: [AuthGuard.isUserLogged],\r\n    validate: null,\r\n    run(){\r\n        const responseMessage = new ResponseMessage();\r\n        const userLogged = Meteor.user();\r\n        const userRoles = Roles.getRolesForUser(userLogged._id, userLogged.profile.profile);\r\n        const optionsOfUser = SystemOptions.reduce(( accumulator, systemOption ) => {\r\n            if (!systemOption.permission || !!userRoles.find(role => role === systemOption.permission)) {\r\n                accumulator.push(systemOption);\r\n            }\r\n            return accumulator;\r\n        }, [])\r\n        responseMessage.create('Opciones del sistema de usuario.', null, optionsOfUser);\r\n        return responseMessage;\r\n    }\r\n})","Meteor.users.rawCollection().createIndex({ 'profile.profile': 1 })","import {ValidatedMethod} from 'meteor/mdg:validated-method';\r\nimport {check, Match} from 'meteor/check';\r\nimport { ResponseMessage } from '../../startup/server/utilities/ResponseMessage';\r\nimport UsersServ from './UsersServ';\r\nimport AuthGuard from '../../middlewares/AuthGuard';\r\nimport Permissions from '../../startup/server/Permissions';\r\n\r\nAccounts.validateLoginAttempt(loginAttempt => {\r\n    if (loginAttempt.allowed) {\r\n        if (!loginAttempt.user.emails[0].verified) {\r\n            throw new Meteor.Error('403', 'El correo de la cuenta no se ha verificado aun.');\r\n        }\r\n        const loginTokensOfUser = loginAttempt.user.services.resume?.loginTokens || [];\r\n        if (loginTokensOfUser.length > 1) {\r\n            Meteor.users.update(loginAttempt.user._id, {\r\n                $set: {\r\n                    'services.resume.loginTokens': [loginTokensOfUser.pop()]\r\n                }\r\n            });\r\n        }\r\n        return true;\r\n    }\r\n});\r\n\r\nnew ValidatedMethod ({\r\n    name: 'user.save',\r\n    mixins: [MethodHooks],\r\n    permissions: [Permissions.USERS.CREATE.VALUE, Permissions.USERS.UPDATE.VALUE],\r\n    beforeHooks: [AuthGuard.checkPermission],\r\n    validate(user){\r\n        try {\r\n            check(user, {\r\n                _id: Match.OneOf(String, null),\r\n                username: String,\r\n                emails: [{address: String, verified: Boolean}],\r\n                profile: {\r\n                    profile: String,\r\n                    name: String,\r\n                    path: Match.OneOf(String, null)\r\n                }\r\n            })\r\n        } catch (error) {\r\n            console.log('save.user', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\r\n        }\r\n        UsersServ.validateEmail(user.emails[0].address, user._id);\r\n        UsersServ.validateUsername(user.username, user._id);\r\n    },\r\n    run(user){\r\n        const responseMessage = new ResponseMessage();\r\n        if (user._id !== null) {\r\n            try {\r\n                // UPDATE USER \r\n                UsersServ.updateUser(user);\r\n                responseMessage.create('Se actualizo el usuario exitosamente');\r\n            } catch (error) {\r\n                console.error('user.save', error);\r\n                throw new Meteor.Error('500', 'Ocurrio un error al actualizar el usuario');\r\n            }\r\n        } else {\r\n            try {\r\n                // CREATE USER\r\n                UsersServ.createUser(user);\r\n                responseMessage.create('Se ha creado usuario exitosamente');\r\n            } catch (error) {\r\n                console.error('user.save: ', error);\r\n                throw new Meteor.Error('500', 'Ocurrió un error al crear un usuario');\r\n            }\r\n        }\r\n        return responseMessage;\r\n    }\r\n});\r\n\r\nnew ValidatedMethod({\r\n    name: 'user.delete',\r\n    mixins: [MethodHooks],\r\n    permissions: [Permissions.USERS.DELETE.VALUE],\r\n    beforeHooks: [AuthGuard.checkPermission],\r\n    validate({idUser}){\r\n        try {\r\n            check(idUser, String);\r\n        } catch (error) {\r\n            console.error('user.delete', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\r\n        }\r\n    },\r\n    run({idUser}){\r\n        const responseMessage = new ResponseMessage;\r\n        try {\r\n            Meteor.users.remove(idUser);\r\n            Meteor.roleAssignment.remove({'user._id': idUser});\r\n            responseMessage.create('Se ha eliminado exitosamente al usuario');\r\n        } catch (error) {\r\n            console.error('user.delete', error);\r\n            throw new Meteor.Error('500', 'Ocurrio un error al eliminar un usuario');\r\n        }\r\n        return responseMessage;\r\n    }\r\n});\r\n\r\nnew ValidatedMethod ({\r\n    name: 'user.updatePersonalData',\r\n    mixins: [MethodHooks],\r\n    beforeHooks: [AuthGuard.isUserLogged],\r\n    validate(user){\r\n        try {\r\n            check(user, {\r\n                _id: Match.OneOf(String, null),\r\n                username: String,\r\n                emails: [{address: String, verified: Boolean}],\r\n                profile: {\r\n                    profile: String,\r\n                    name: String,\r\n                    path: Match.OneOf(String, null)\r\n                }\r\n            })\r\n        } catch (error) {\r\n            console.log('user.updatePersonalData', error);\r\n            throw new Meteor.Error('403', 'La informacion introducida no es valida');\r\n        }\r\n        UsersServ.validateEmail(user.emails[0].address, user._id);\r\n        UsersServ.validateUsername(user.username, user._id);\r\n    },\r\n    run(user){\r\n        const responseMessage = new ResponseMessage();\r\n        try {\r\n            // UPDATE USER \r\n            UsersServ.updateUser(user);\r\n            responseMessage.create('Se actualizo la informacion exitosamente');\r\n        } catch (error) {\r\n            console.error('user.updatePersonalData', error);\r\n            throw new Meteor.Error('500', 'Ocurrio un error al actualizar la informacion');\r\n        }\r\n        return responseMessage;\r\n    }\r\n}); ","import {Meteor} from 'meteor/meteor';\r\nimport {PublishEndpoint} from 'meteor/peerlibrary:middleware';\r\nimport { PermissionMiddleware } from '../../middlewares/PermissionsMiddleware';\r\nimport Permissions from '../../startup/server/Permissions';\r\n\r\nconst usersPublication = new PublishEndpoint('user.list', function() {\r\n    return Meteor.users.find({}, {\r\n        sort: {createdAt: -1}\r\n    });\r\n});\r\n\r\nusersPublication.use(new PermissionMiddleware([Permissions.USERS.LIST.VALUE]));","import ProfilesServ from '../Profiles/ProfilesServ';\r\n\r\nexport default {\r\n    validateEmail(newEmail, idUser){\r\n        const existEmail = Accounts.findUserByEmail(newEmail);\r\n        if (idUser) {\r\n            const oldUser = Meteor.users.findOne(idUser);\r\n            if (oldUser.emails[0].address !== newEmail && existEmail) {\r\n                throw new Meteor.Error('403', 'El nuevo email ya se encuentra en uso');\r\n            }\r\n        } else if (existEmail) {\r\n            throw new Meteor.Error('403', 'El nuevo email ya se encuetra en uso');\r\n        }\r\n    },\r\n    validateUsername(newUsername, idUser){\r\n        const existUsername = Accounts.findUserByUsername(newUsername);\r\n        if (idUser) {\r\n            const oldUser = Meteor.users.findOne(idUser);\r\n            if (oldUser.username !== newUsername && existUsername) {\r\n                throw new Meteor.Error('403', \"El nuevo nombre de usuario ya se encuentra en uso\");\r\n            }\r\n        } else if (existUsername) {\r\n            throw new Meteor.Error('403', \"El nombre de usuario ya se encuentra en uso\");\r\n        }\r\n    },\r\n    createUser(user){\r\n        const idUser = Accounts.createUser({\r\n            username: user.username,\r\n            email: user.emails[0].address,\r\n            profile: user.profile\r\n        });\r\n        if (idUser) {\r\n            ProfilesServ.setUserRoles(idUser, user.profile.profile);\r\n            Accounts.sendEnrollmentEmail(idUser, user.emails[0].address);\r\n        }\r\n    },\r\n    updateUser(user){\r\n        const currentUser = Meteor.users.findOne(user._id);\r\n        if (currentUser.emails[0].address !== user.emails[0].address) {\r\n            Accounts.removeEmail(currentUser._id, currentUser.emails[0].address);\r\n            Accounts.addEmail(currentUser._id, user.emails[0].address);\r\n            Accounts.sendVerificationEmail(user._id, user.emails[0].address);\r\n        }\r\n        if (currentUser.username !== user.username) {\r\n            Accounts.setUsername(currentUser._id, user.username);\r\n        }\r\n        Meteor.users.update(user._id, {\r\n            $set: {\r\n                profile: {\r\n                    profile: user.profile.profile,\r\n                    name: user.profile.name,\r\n                    path: user.profile.path\r\n                }\r\n            }\r\n        });\r\n        ProfilesServ.setUserRoles(user._id, user.profile.profile);\r\n    }\r\n};","const checkPermission = function (methodArgs, methodOptions) {\r\n    const idUser = this.userId;\r\n    const permissions = methodOptions.permissions;\r\n    let hasPermission = false;\r\n    if (idUser !== null) {\r\n        const profileName = Meteor.user().profile.profile;\r\n        hasPermission = Roles.userIsInRole(idUser, permissions, profileName);\r\n    }\r\n    if (!hasPermission) {\r\n        throw new Meteor.Error('403', 'Acceso denegado', \r\n                    'No tienes permiso para ejecutar esta accion');\r\n    }\r\n    return methodArgs;\r\n};\r\n\r\nconst isUserLogged = function(methodArgs, methodOptions) {\r\n    if (!this.userId) {\r\n        throw new Meteor.Error('403', 'Acceso denegado', \r\n                    'No tienes permiso para ejecutar esta accion');\r\n    }\r\n    return methodArgs;\r\n}\r\n\r\nexport default { checkPermission, isUserLogged };","export class PermissionMiddleware extends PublishMiddleware {\r\n    constructor (permissions) {\r\n        super();\r\n        this._permissions = permissions;\r\n    }\r\n    \r\n    added (publish, collection, id, fields) {\r\n        if (publish.userId) {\r\n            return super.added(...arguments);\r\n        }\r\n        return publish.ready();\r\n    }\r\n    \r\n    change (publish, collection, id, fields) {\r\n        if (this.checkPermission(publish.userId)) {\r\n            return super.changed(...arguments);\r\n        }\r\n        return publish.ready();\r\n    }\r\n    \r\n    removed (publish, collection, id) {\r\n        if (this.checkPermission(publish.userId)) {\r\n            return super.removed(...arguments);\r\n        }\r\n        return publish.ready();\r\n    }\r\n\r\n    onReady (publish) {\r\n        if (publish.userId) {\r\n            return super.onReady(...arguments);\r\n        }\r\n    }\r\n\r\n    onStop (publish) {\r\n        if (publish.userId) {\r\n            return super.onStop(...arguments);\r\n        }\r\n    }\r\n\r\n    onError (publish) {\r\n        if (publish.userId) {\r\n            return super.onError(...arguments);\r\n        }\r\n    }\r\n\r\n    checkPermission (idUser) {\r\n        const profileName = Roles.getScopesForUser(idUser)[0];\r\n        return Roles.userIsInRole(idUser, this._permissions, profileName);\r\n    }\r\n};","import \"/imports/startup/server\";\r\nimport \"/imports/startup/both\";"]}}]