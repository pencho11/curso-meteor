{"code":"module.exportDefault = function(value) { __vue_script__ = value; }; (function(){var Message;\nmodule.link(\"../../../api/Messages/Message\", {\n  Message: function (v) {\n    Message = v;\n  }\n}, 0);\nvar date;\nmodule.link(\"../../mixins/helpers/date\", {\n  \"default\": function (v) {\n    date = v;\n  }\n}, 1);\nmodule.exportDefault({\n  name: 'Chat',\n  mixins: [date],\n  data: function () {\n    return {\n      contactSelected: null,\n      message: {\n        idSender: null,\n        idReceiver: null,\n        date: null,\n        text: null\n      }\n    };\n  },\n  updated: function () {\n    var elem = this.$el.querySelector('#msgContainer');\n\n    if (elem) {\n      elem.scrollTop = elem.scrollHeight;\n    }\n  },\n  methods: {\n    sendMessage: function () {\n      var _this = this;\n\n      this.message.idSender = Meteor.userId();\n      this.message.idReceiver = this.contactSelected._id;\n      this.message.date = this.currentLocalDate().toISOString();\n      Meteor.call('message.save', this.message, function (error, response) {\n        if (error) {\n          _this.$alert.showAlertSimple('error', error.reason);\n        } else {\n          _this.message.text = null;\n        }\n      });\n    }\n  },\n  meteor: {\n    $subscribe: {\n      'user.list': [],\n      'messages.list': function () {\n        return [this.contactSelected ? this.contactSelected._id : null];\n      }\n    },\n    users: function () {\n      return Meteor.users.find({\n        _id: {\n          $ne: Meteor.userId()\n        }\n      }).fetch();\n    },\n    messages: function () {\n      return this.contactSelected ? Message.find({}, {\n        sort: {\n          date: 1\n        }\n      }).fetch() : [];\n    }\n  }\n});\n})();","map":{"version":3,"sources":["imports/ui/views/Chat/Chat.vue"],"names":["Message","module","link","v","date","exportDefault","name","mixins","data","contactSelected","message","idSender","idReceiver","text","updated","elem","$el","querySelector","scrollTop","scrollHeight","methods","sendMessage","Meteor","userId","_id","currentLocalDate","toISOString","call","error","response","$alert","showAlertSimple","reason","meteor","$subscribe","users","find","$ne","fetch","messages","sort"],"mappings":";;;;;;;;;;;;qBAyEA;AACA,EAAA,IAAA,EAAA,MADA;AAEA,EAAA,MAAA,EAAA,CAAA,IAAA,CAFA;AAGA,EAAA,IAHA,cAGA;AACA,WAAA;AACA,MAAA,eAAA,EAAA,IADA;AAEA,MAAA,OAAA,EAAA;AACA,QAAA,QAAA,EAAA,IADA;AAEA,QAAA,UAAA,EAAA,IAFA;AAGA,QAAA,IAAA,EAAA,IAHA;AAIA,QAAA,IAAA,EAAA;AAJA;AAFA,KAAA;AASA,GAbA;AAcA,EAAA,OAdA,cAcA;AACA,QAAA,IAAA,GAAA,KAAA,GAAA,CAAA,aAAA,CAAA,eAAA,CAAA;;AACA,QAAA,IAAA,EAAA;AACA,MAAA,IAAA,CAAA,SAAA,GAAA,IAAA,CAAA,YAAA;AACA;AACA,GAnBA;AAoBA,EAAA,OAAA,EAAA;AACA,IAAA,WADA,cACA;AAAA;;AACA,WAAA,OAAA,CAAA,QAAA,GAAA,MAAA,CAAA,MAAA,EAAA;AACA,WAAA,OAAA,CAAA,UAAA,GAAA,KAAA,eAAA,CAAA,GAAA;AACA,WAAA,OAAA,CAAA,IAAA,GAAA,KAAA,gBAAA,GAAA,WAAA,EAAA;AAEA,MAAA,MAAA,CAAA,IAAA,CAAA,cAAA,EAAA,KAAA,OAAA,EAAA,UAAA,KAAA,EAAA,QAAA,EAAA;AACA,YAAA,KAAA,EAAA;AACA,UAAA,KAAA,CAAA,MAAA,CAAA,eAAA,CAAA,OAAA,EAAA,KAAA,CAAA,MAAA;AACA,SAFA,MAEA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,IAAA,GAAA,IAAA;AACA;AACA,OANA;AAOA;AAbA,GApBA;AAmCA,EAAA,MAAA,EAAA;AACA,IAAA,UAAA,EAAA;AACA,mBAAA,EADA;AAEA,uBAAA,YAAA;AACA,eAAA,CAAA,KAAA,eAAA,GAAA,KAAA,eAAA,CAAA,GAAA,GAAA,IAAA,CAAA;AACA;AAJA,KADA;AAOA,IAAA,KAPA,cAOA;AACA,aAAA,MAAA,CAAA,KAAA,CAAA,IAAA,CAAA;AAAA,QAAA,GAAA,EAAA;AAAA,UAAA,GAAA,EAAA,MAAA,CAAA,MAAA;AAAA;AAAA,OAAA,EAAA,KAAA,EAAA;AACA,KATA;AAUA,IAAA,QAVA,cAUA;AACA,aAAA,KAAA,eAAA,GAAA,OAAA,CAAA,IAAA,CAAA,EAAA,EAAA;AACA,QAAA,IAAA,EAAA;AACA,UAAA,IAAA,EAAA;AADA;AADA,OAAA,EAIA,KAJA,EAAA,GAIA,EAJA;AAKA;AAhBA;AAnCA","sourcesContent":["<template>\r\n    <v-container fluid>\r\n        <v-row>\r\n            <v-col cols=\"12\" xs=\"12\" sm=\"4\" md=\"3\" lg=\"2\" xl=\"2\">\r\n                <v-card class=\"mx-auto\" max-width=\"300\" tile>\r\n                    <v-list subheader>\r\n                        <v-subheader>CONTACTOS</v-subheader>\r\n                        <v-list-item-group v-model=\"contactSelected\" color=\"primary\">\r\n                            <v-divider></v-divider>\r\n                            <template v-for=\"contact in users\">\r\n                                <v-list-item :key=\"contact._id\" :value=\"contact\">\r\n                                    <v-list-item-icon>\r\n                                        <v-icon :color=\"contact.status.online?'green':'red'\">\r\n                                            mdi-checkbox-blank-circle\r\n                                        </v-icon>\r\n                                    </v-list-item-icon>\r\n                                    <v-list-item-content>\r\n                                        <v-list-item-title v-text=\"contact.profile.name\">\r\n                                        </v-list-item-title>\r\n                                    </v-list-item-content>\r\n                                </v-list-item>\r\n                            </template>\r\n                        </v-list-item-group>\r\n                    </v-list>\r\n                </v-card>\r\n            </v-col>\r\n            <v-col cols=\"12\" xs=\"12\" sm=\"8\" md=\"9\" lg=\"10\" xl=\"10\">\r\n                <v-card class=\"mx-auto\" v-if=\"contactSelected\" height=\"70vh\">\r\n                    <v-list-item>\r\n                        <v-list-item-avatar size=\"36px\">\r\n                            <img :src=\"contactSelected.profile.path || 'img/user.png'\" alt=\"Avatar\">\r\n                        </v-list-item-avatar>\r\n                        <v-list-item-title class=\"headline\">{{contactSelected.profile.name}}</v-list-item-title>\r\n                    </v-list-item>\r\n                    <v-card-text id=\"msgContainer\" style=\"height: 70%\" class=\"overflow-y-auto\">\r\n                        <v-row v-for=\"msg in messages\" :class=\"msg.idReceiver===contactSelected._id?'justify-end':'justify-start'\">\r\n                            <v-col cols=\"7\">\r\n                                <v-card raised shaped :color=\"msg.idReceiver===contactSelected._id?'cyan lighten-5':'red lighten-5'\">\r\n                                    <v-card-text class=\"pb-1\">\r\n                                        {{msg.text}}\r\n                                    </v-card-text>\r\n                                    <v-card-subtitle class=\"text-right pt-1 pb-1\">\r\n                                        <v-icon style=\"margin-right: -15px\" small color=\"red\">\r\n                                            check\r\n                                        </v-icon>\r\n                                        <v-icon small color=\"red\">\r\n                                            check\r\n                                        </v-icon>\r\n                                    </v-card-subtitle>\r\n                                </v-card>\r\n                            </v-col>\r\n                        </v-row>    \r\n                    </v-card-text>\r\n                    <v-card-actions>\r\n                        <v-text-field v-model=\"message.text\" v-on:keyup.enter=\"sendMessage\" label=\"Introduce tu mensaje\">\r\n                        </v-text-field>\r\n                        <v-btn class=\"mx-2\" @click=\"sendMessage\" fab dark color=\"indigo\">\r\n                            <v-icon dark>send</v-icon>\r\n                        </v-btn>\r\n                    </v-card-actions>\r\n                </v-card>\r\n                <v-card v-else height=\"70vh\">\r\n                    <h1>Bienvenidos al Chat</h1>\r\n                </v-card>\r\n            </v-col>\r\n        </v-row>\r\n    </v-container>\r\n</template>\r\n\r\n<script>\r\n    import {Message} from '../../../api/Messages/Message';\r\n    import date from '../../mixins/helpers/date';\r\n\r\n    export default {\r\n        name: 'Chat',\r\n        mixins: [date],\r\n        data() {\r\n            return {\r\n                contactSelected: null,\r\n                message: {\r\n                    idSender: null,\r\n                    idReceiver: null,\r\n                    date: null,\r\n                    text: null\r\n                }\r\n            }\r\n        },\r\n        updated() {\r\n            const elem = this.$el.querySelector('#msgContainer');\r\n            if (elem) {\r\n                elem.scrollTop = elem.scrollHeight;\r\n            }\r\n        },\r\n        methods: {\r\n            sendMessage() {\r\n                this.message.idSender = Meteor.userId();\r\n                this.message.idReceiver = this.contactSelected._id;\r\n                this.message.date = this.currentLocalDate().toISOString();\r\n\r\n                Meteor.call('message.save', this.message, (error, response) => {\r\n                    if (error) {\r\n                        this.$alert.showAlertSimple('error', error.reason);\r\n                    } else {\r\n                        this.message.text = null;\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        meteor: {\r\n            $subscribe: {\r\n                'user.list': [],\r\n                'messages.list': function () {\r\n                    return [this.contactSelected ? this.contactSelected._id : null];\r\n                }\r\n            },\r\n            users() {\r\n                return Meteor.users.find({ _id: { $ne: Meteor.userId() } }).fetch(); \r\n            },\r\n            messages() {\r\n                return this.contactSelected ? Message.find({},{\r\n                    sort: {\r\n                        date: 1\r\n                    }\r\n                }).fetch() : [];\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"],"file":"imports/ui/views/Chat/Chat.vue"},"styles":[{"css":"\n\n","map":{"version":3,"sources":[],"names":[],"mappings":"","file":"Chat.vue"}}],"template":"\n<v-container fluid>\n    <v-row>\n        <v-col cols=\"12\" xs=\"12\" sm=\"4\" md=\"3\" lg=\"2\" xl=\"2\">\n            <v-card class=\"mx-auto\" max-width=\"300\" tile>\n                <v-list subheader>\n                    <v-subheader>CONTACTOS</v-subheader>\n                    <v-list-item-group v-model=\"contactSelected\" color=\"primary\">\n                        <v-divider></v-divider>\n                        <template v-for=\"contact in users\">\n                            <v-list-item :key=\"contact._id\" :value=\"contact\">\n                                <v-list-item-icon>\n                                    <v-icon :color=\"contact.status.online?'green':'red'\">\n                                        mdi-checkbox-blank-circle\n                                    </v-icon>\n                                </v-list-item-icon>\n                                <v-list-item-content>\n                                    <v-list-item-title v-text=\"contact.profile.name\">\n                                    </v-list-item-title>\n                                </v-list-item-content>\n                            </v-list-item>\n                        </template>\n                    </v-list-item-group>\n                </v-list>\n            </v-card>\n        </v-col>\n        <v-col cols=\"12\" xs=\"12\" sm=\"8\" md=\"9\" lg=\"10\" xl=\"10\">\n            <v-card class=\"mx-auto\" v-if=\"contactSelected\" height=\"70vh\">\n                <v-list-item>\n                    <v-list-item-avatar size=\"36px\">\n                        <img :src=\"contactSelected.profile.path || 'img/user.png'\" alt=\"Avatar\">\n                    </v-list-item-avatar>\n                    <v-list-item-title class=\"headline\">{{contactSelected.profile.name}}</v-list-item-title>\n                </v-list-item>\n                <v-card-text id=\"msgContainer\" style=\"height: 70%\" class=\"overflow-y-auto\">\n                    <v-row v-for=\"msg in messages\" :class=\"msg.idReceiver===contactSelected._id?'justify-end':'justify-start'\">\n                        <v-col cols=\"7\">\n                            <v-card raised shaped :color=\"msg.idReceiver===contactSelected._id?'cyan lighten-5':'red lighten-5'\">\n                                <v-card-text class=\"pb-1\">\n                                    {{msg.text}}\n                                </v-card-text>\n                                <v-card-subtitle class=\"text-right pt-1 pb-1\">\n                                    <v-icon style=\"margin-right: -15px\" small color=\"red\">\n                                        check\n                                    </v-icon>\n                                    <v-icon small color=\"red\">\n                                        check\n                                    </v-icon>\n                                </v-card-subtitle>\n                            </v-card>\n                        </v-col>\n                    </v-row>    \n                </v-card-text>\n                <v-card-actions>\n                    <v-text-field v-model=\"message.text\" v-on:keyup.enter=\"sendMessage\" label=\"Introduce tu mensaje\">\n                    </v-text-field>\n                    <v-btn class=\"mx-2\" @click=\"sendMessage\" fab dark color=\"indigo\">\n                        <v-icon dark>send</v-icon>\n                    </v-btn>\n                </v-card-actions>\n            </v-card>\n            <v-card v-else height=\"70vh\">\n                <h1>Bienvenidos al Chat</h1>\n            </v-card>\n        </v-col>\n    </v-row>\n</v-container>\n","hash":"data-v-2dc1bbe5"}