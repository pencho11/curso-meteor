{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\RUBEN\\Desktop\\meteor-vue\\imports\\middlewares\\PermissionsMiddleware.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.windows.x86_64"},"sourceFileName":"imports/middlewares/PermissionsMiddleware.js","filename":"C:\\Users\\RUBEN\\Desktop\\meteor-vue\\imports\\middlewares\\PermissionsMiddleware.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"C:\\Users\\RUBEN\\Desktop\\meteor-vue","root":"C:\\Users\\RUBEN\\Desktop\\meteor-vue","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.14.0","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Users\\RUBEN\\Desktop\\meteor-vue\\imports\\middlewares\\PermissionsMiddleware.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/middlewares/PermissionsMiddleware.js"}},"code":"module.export({\n  PermissionMiddleware: () => PermissionMiddleware\n});\n\nclass PermissionMiddleware extends PublishMiddleware {\n  constructor(permissions) {\n    super();\n    this._permissions = permissions;\n  }\n\n  added(publish, collection, id, fields) {\n    if (publish.userId) {\n      return super.added(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  change(publish, collection, id, fields) {\n    if (this.checkPermission(publish.userId)) {\n      return super.changed(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  removed(publish, collection, id) {\n    if (this.checkPermission(publish.userId)) {\n      return super.removed(...arguments);\n    }\n\n    return publish.ready();\n  }\n\n  onReady(publish) {\n    if (publish.userId) {\n      return super.onReady(...arguments);\n    }\n  }\n\n  onStop(publish) {\n    if (publish.userId) {\n      return super.onStop(...arguments);\n    }\n  }\n\n  onError(publish) {\n    if (publish.userId) {\n      return super.onError(...arguments);\n    }\n  }\n\n  checkPermission(idUser) {\n    const profileName = Roles.getScopesForUser(idUser)[0];\n    return Roles.userIsInRole(idUser, this._permissions, profileName);\n  }\n\n}\n\n;","map":{"version":3,"sources":["imports/middlewares/PermissionsMiddleware.js"],"names":["module","export","PermissionMiddleware","PublishMiddleware","constructor","permissions","_permissions","added","publish","collection","id","fields","userId","arguments","ready","change","checkPermission","changed","removed","onReady","onStop","onError","idUser","profileName","Roles","getScopesForUser","userIsInRole"],"mappings":"AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,oBAAoB,EAAC,MAAIA;AAA1B,CAAd;;AAAO,MAAMA,oBAAN,SAAmCC,iBAAnC,CAAqD;AACxDC,EAAAA,WAAW,CAAEC,WAAF,EAAe;AACtB;AACA,SAAKC,YAAL,GAAoBD,WAApB;AACH;;AAEDE,EAAAA,KAAK,CAAEC,OAAF,EAAWC,UAAX,EAAuBC,EAAvB,EAA2BC,MAA3B,EAAmC;AACpC,QAAIH,OAAO,CAACI,MAAZ,EAAoB;AAChB,aAAO,MAAML,KAAN,CAAY,GAAGM,SAAf,CAAP;AACH;;AACD,WAAOL,OAAO,CAACM,KAAR,EAAP;AACH;;AAEDC,EAAAA,MAAM,CAAEP,OAAF,EAAWC,UAAX,EAAuBC,EAAvB,EAA2BC,MAA3B,EAAmC;AACrC,QAAI,KAAKK,eAAL,CAAqBR,OAAO,CAACI,MAA7B,CAAJ,EAA0C;AACtC,aAAO,MAAMK,OAAN,CAAc,GAAGJ,SAAjB,CAAP;AACH;;AACD,WAAOL,OAAO,CAACM,KAAR,EAAP;AACH;;AAEDI,EAAAA,OAAO,CAAEV,OAAF,EAAWC,UAAX,EAAuBC,EAAvB,EAA2B;AAC9B,QAAI,KAAKM,eAAL,CAAqBR,OAAO,CAACI,MAA7B,CAAJ,EAA0C;AACtC,aAAO,MAAMM,OAAN,CAAc,GAAGL,SAAjB,CAAP;AACH;;AACD,WAAOL,OAAO,CAACM,KAAR,EAAP;AACH;;AAEDK,EAAAA,OAAO,CAAEX,OAAF,EAAW;AACd,QAAIA,OAAO,CAACI,MAAZ,EAAoB;AAChB,aAAO,MAAMO,OAAN,CAAc,GAAGN,SAAjB,CAAP;AACH;AACJ;;AAEDO,EAAAA,MAAM,CAAEZ,OAAF,EAAW;AACb,QAAIA,OAAO,CAACI,MAAZ,EAAoB;AAChB,aAAO,MAAMQ,MAAN,CAAa,GAAGP,SAAhB,CAAP;AACH;AACJ;;AAEDQ,EAAAA,OAAO,CAAEb,OAAF,EAAW;AACd,QAAIA,OAAO,CAACI,MAAZ,EAAoB;AAChB,aAAO,MAAMS,OAAN,CAAc,GAAGR,SAAjB,CAAP;AACH;AACJ;;AAEDG,EAAAA,eAAe,CAAEM,MAAF,EAAU;AACrB,UAAMC,WAAW,GAAGC,KAAK,CAACC,gBAAN,CAAuBH,MAAvB,EAA+B,CAA/B,CAApB;AACA,WAAOE,KAAK,CAACE,YAAN,CAAmBJ,MAAnB,EAA2B,KAAKhB,YAAhC,EAA8CiB,WAA9C,CAAP;AACH;;AAhDuD;;AAiD3D","sourcesContent":["export class PermissionMiddleware extends PublishMiddleware {\r\n    constructor (permissions) {\r\n        super();\r\n        this._permissions = permissions;\r\n    }\r\n    \r\n    added (publish, collection, id, fields) {\r\n        if (publish.userId) {\r\n            return super.added(...arguments);\r\n        }\r\n        return publish.ready();\r\n    }\r\n    \r\n    change (publish, collection, id, fields) {\r\n        if (this.checkPermission(publish.userId)) {\r\n            return super.changed(...arguments);\r\n        }\r\n        return publish.ready();\r\n    }\r\n    \r\n    removed (publish, collection, id) {\r\n        if (this.checkPermission(publish.userId)) {\r\n            return super.removed(...arguments);\r\n        }\r\n        return publish.ready();\r\n    }\r\n\r\n    onReady (publish) {\r\n        if (publish.userId) {\r\n            return super.onReady(...arguments);\r\n        }\r\n    }\r\n\r\n    onStop (publish) {\r\n        if (publish.userId) {\r\n            return super.onStop(...arguments);\r\n        }\r\n    }\r\n\r\n    onError (publish) {\r\n        if (publish.userId) {\r\n            return super.onError(...arguments);\r\n        }\r\n    }\r\n\r\n    checkPermission (idUser) {\r\n        const profileName = Roles.getScopesForUser(idUser)[0];\r\n        return Roles.userIsInRole(idUser, this._permissions, profileName);\r\n    }\r\n};"]},"sourceType":"module","hash":"e420e787445499e843349a615c764b0d76d4a526"}
