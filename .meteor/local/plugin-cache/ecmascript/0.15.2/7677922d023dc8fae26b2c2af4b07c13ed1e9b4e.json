{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\RUBEN\\Desktop\\meteor-vue\\imports\\api\\Users\\UsersServ.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.windows.x86_64"},"sourceFileName":"imports/api/Users/UsersServ.js","filename":"C:\\Users\\RUBEN\\Desktop\\meteor-vue\\imports\\api\\Users\\UsersServ.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"C:\\Users\\RUBEN\\Desktop\\meteor-vue","root":"C:\\Users\\RUBEN\\Desktop\\meteor-vue","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.14.0","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Users\\RUBEN\\Desktop\\meteor-vue\\imports\\api\\Users\\UsersServ.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/Users/UsersServ.js"}},"code":"let FileOperations;\nmodule.link(\"../../startup/server/utilities/FileOperations\", {\n  default(v) {\n    FileOperations = v;\n  }\n\n}, 0);\nlet ProfilesServ;\nmodule.link(\"../Profiles/ProfilesServ\", {\n  default(v) {\n    ProfilesServ = v;\n  }\n\n}, 1);\nconst PATH_USER_FILES = 'users/';\nmodule.exportDefault({\n  validateEmail(newEmail, idUser) {\n    const existEmail = Accounts.findUserByEmail(newEmail);\n\n    if (idUser) {\n      const oldUser = Meteor.users.findOne(idUser);\n\n      if (oldUser.emails[0].address !== newEmail && existEmail) {\n        throw new Meteor.Error('403', 'El nuevo email ya se encuentra en uso');\n      }\n    } else if (existEmail) {\n      throw new Meteor.Error('403', 'El nuevo email ya se encuetra en uso');\n    }\n  },\n\n  validateUsername(newUsername, idUser) {\n    const existUsername = Accounts.findUserByUsername(newUsername);\n\n    if (idUser) {\n      const oldUser = Meteor.users.findOne(idUser);\n\n      if (oldUser.username !== newUsername && existUsername) {\n        throw new Meteor.Error('403', \"El nuevo nombre de usuario ya se encuentra en uso\");\n      }\n    } else if (existUsername) {\n      throw new Meteor.Error('403', \"El nombre de usuario ya se encuentra en uso\");\n    }\n  },\n\n  createUser(user, photoFileUser) {\n    return Promise.asyncApply(() => {\n      const idUser = Accounts.createUser({\n        username: user.username,\n        email: user.emails[0].address,\n        profile: user.profile\n      });\n      let avatarSrc = null;\n\n      if (idUser) {\n        ProfilesServ.setUserRoles(idUser, user.profile.profile);\n        Accounts.sendEnrollmentEmail(idUser, user.emails[0].address);\n      }\n\n      if (photoFileUser) {\n        const response = Promise.await(FileOperations.saveFileFromBase64ToGoogleStorage(photoFileUser, 'avatar', PATH_USER_FILES + idUser));\n\n        if (!response.data.success) {\n          throw new Meteor.Error('500', 'Error al subir la foto');\n        } else {\n          avatarSrc = response.data.fileUrl;\n        }\n      }\n\n      Meteor.users.update(idUser, {\n        $set: {\n          'profile.path': avatarSrc\n        }\n      });\n    });\n  },\n\n  updateUser(user) {\n    const currentUser = Meteor.users.findOne(user._id);\n\n    if (currentUser.emails[0].address !== user.emails[0].address) {\n      Accounts.removeEmail(currentUser._id, currentUser.emails[0].address);\n      Accounts.addEmail(currentUser._id, user.emails[0].address);\n      Accounts.sendVerificationEmail(user._id, user.emails[0].address);\n    }\n\n    if (currentUser.username !== user.username) {\n      Accounts.setUsername(currentUser._id, user.username);\n    }\n\n    Meteor.users.update(user._id, {\n      $set: {\n        profile: {\n          profile: user.profile.profile,\n          name: user.profile.name,\n          path: user.profile.path\n        }\n      }\n    });\n    ProfilesServ.setUserRoles(user._id, user.profile.profile);\n  }\n\n});","map":{"version":3,"sources":["imports/api/Users/UsersServ.js"],"names":["FileOperations","module","link","default","v","ProfilesServ","PATH_USER_FILES","exportDefault","validateEmail","newEmail","idUser","existEmail","Accounts","findUserByEmail","oldUser","Meteor","users","findOne","emails","address","Error","validateUsername","newUsername","existUsername","findUserByUsername","username","createUser","user","photoFileUser","email","profile","avatarSrc","setUserRoles","sendEnrollmentEmail","response","saveFileFromBase64ToGoogleStorage","data","success","fileUrl","update","$set","updateUser","currentUser","_id","removeEmail","addEmail","sendVerificationEmail","setUsername","name","path"],"mappings":"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","sourcesContent":["import FileOperations from '../../startup/server/utilities/FileOperations';\r\nimport ProfilesServ from '../Profiles/ProfilesServ';\r\n\r\nconst PATH_USER_FILES = 'users/';\r\n\r\nexport default {\r\n    validateEmail(newEmail, idUser){\r\n        const existEmail = Accounts.findUserByEmail(newEmail);\r\n        if (idUser) {\r\n            const oldUser = Meteor.users.findOne(idUser);\r\n            if (oldUser.emails[0].address !== newEmail && existEmail) {\r\n                throw new Meteor.Error('403', 'El nuevo email ya se encuentra en uso');\r\n            }\r\n        } else if (existEmail) {\r\n            throw new Meteor.Error('403', 'El nuevo email ya se encuetra en uso');\r\n        }\r\n    },\r\n    validateUsername(newUsername, idUser){\r\n        const existUsername = Accounts.findUserByUsername(newUsername);\r\n        if (idUser) {\r\n            const oldUser = Meteor.users.findOne(idUser);\r\n            if (oldUser.username !== newUsername && existUsername) {\r\n                throw new Meteor.Error('403', \"El nuevo nombre de usuario ya se encuentra en uso\");\r\n            }\r\n        } else if (existUsername) {\r\n            throw new Meteor.Error('403', \"El nombre de usuario ya se encuentra en uso\");\r\n        }\r\n    },\r\n    async createUser(user, photoFileUser){\r\n        const idUser = Accounts.createUser({\r\n            username: user.username,\r\n            email: user.emails[0].address,\r\n            profile: user.profile\r\n        });\r\n        let avatarSrc= null;\r\n        if (idUser) {\r\n            ProfilesServ.setUserRoles(idUser, user.profile.profile);\r\n            Accounts.sendEnrollmentEmail(idUser, user.emails[0].address);\r\n        }\r\n        if (photoFileUser) {\r\n            const response = await FileOperations.saveFileFromBase64ToGoogleStorage(photoFileUser, 'avatar',\r\n            PATH_USER_FILES + idUser);\r\n            if (!response.data.success) {\r\n                throw new Meteor.Error('500', 'Error al subir la foto');\r\n            } else {\r\n                avatarSrc = response.data.fileUrl\r\n            }\r\n        }\r\n        Meteor.users.update(idUser, {\r\n            $set: {\r\n                'profile.path': avatarSrc\r\n            }\r\n        })\r\n    },\r\n    updateUser(user){\r\n        const currentUser = Meteor.users.findOne(user._id);\r\n        if (currentUser.emails[0].address !== user.emails[0].address) {\r\n            Accounts.removeEmail(currentUser._id, currentUser.emails[0].address);\r\n            Accounts.addEmail(currentUser._id, user.emails[0].address);\r\n            Accounts.sendVerificationEmail(user._id, user.emails[0].address);\r\n        }\r\n        if (currentUser.username !== user.username) {\r\n            Accounts.setUsername(currentUser._id, user.username);\r\n        }\r\n        Meteor.users.update(user._id, {\r\n            $set: {\r\n                profile: {\r\n                    profile: user.profile.profile,\r\n                    name: user.profile.name,\r\n                    path: user.profile.path\r\n                }\r\n            }\r\n        });\r\n        ProfilesServ.setUserRoles(user._id, user.profile.profile);\r\n    }\r\n};"]},"sourceType":"module","hash":"7677922d023dc8fae26b2c2af4b07c13ed1e9b4e"}
